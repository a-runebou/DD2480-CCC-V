<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- saved from url=(0163)file://wsl.localhost/Ubuntu/home/user/se/DD2480-CCC-V/target/site/jacoco/org.apache.commons.imaging.formats.tiff.datareaders/AbstractImageDataReader.java.html#L560 -->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><link rel="stylesheet" href="./AbstractImageDataReaderAfter.java_files/report.css" type="text/css"><link rel="shortcut icon" href="file://wsl.localhost/Ubuntu/home/user/se/DD2480-CCC-V/target/site/jacoco/jacoco-resources/report.gif" type="image/gif"><title>AbstractImageDataReader.java</title><link rel="stylesheet" href="./AbstractImageDataReaderAfter.java_files/prettify.css" type="text/css"><script type="text/javascript" src="./AbstractImageDataReaderAfter.java_files/prettify.js.download"></script></head><body onload="window[&#39;PR_TAB_WIDTH&#39;]=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="file://wsl.localhost/Ubuntu/home/user/se/DD2480-CCC-V/target/site/jacoco/jacoco-sessions.html" class="el_session">Sessions</a></span><a href="file://wsl.localhost/Ubuntu/home/user/se/DD2480-CCC-V/target/site/jacoco/index.html" class="el_report">Apache Commons Imaging</a> &gt; <a href="file://wsl.localhost/Ubuntu/home/user/se/DD2480-CCC-V/target/site/jacoco/org.apache.commons.imaging.formats.tiff.datareaders/index.source.html" class="el_package">org.apache.commons.imaging.formats.tiff.datareaders</a> &gt; <span class="el_source">AbstractImageDataReader.java</span></div><h1>AbstractImageDataReader.java</h1><pre class="source lang-java linenums"><ol class="linenums"><li class="L0"><span class="com">/*</span><br></li><li class="L1"><span class="com">&nbsp;* Licensed to the Apache Software Foundation (ASF) under one or more</span><br></li><li class="L2"><span class="com">&nbsp;* contributor license agreements. &nbsp;See the NOTICE file distributed with</span><br></li><li class="L3"><span class="com">&nbsp;* this work for additional information regarding copyright ownership.</span><br></li><li class="L4"><span class="com">&nbsp;* The ASF licenses this file to You under the Apache License, Version 2.0</span><br></li><li class="L5"><span class="com">&nbsp;* (the "License"); you may not use this file except in compliance with</span><br></li><li class="L6"><span class="com">&nbsp;* the License. &nbsp;You may obtain a copy of the License at</span><br></li><li class="L7"><span class="com">&nbsp;*</span><br></li><li class="L8"><span class="com">&nbsp;* &nbsp; &nbsp; &nbsp;https://www.apache.org/licenses/LICENSE-2.0</span><br></li><li class="L9"><span class="com">&nbsp;*</span><br></li><li class="L0"><span class="com">&nbsp;* Unless required by applicable law or agreed to in writing, software</span><br></li><li class="L1"><span class="com">&nbsp;* distributed under the License is distributed on an "AS IS" BASIS,</span><br></li><li class="L2"><span class="com">&nbsp;* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br></li><li class="L3"><span class="com">&nbsp;* See the License for the specific language governing permissions and</span><br></li><li class="L4"><span class="com">&nbsp;* limitations under the License.</span><br></li><li class="L5"><span class="com">&nbsp;*/</span><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">apache</span><span class="pun">.</span><span class="pln">commons</span><span class="pun">.</span><span class="pln">imaging</span><span class="pun">.</span><span class="pln">formats</span><span class="pun">.</span><span class="pln">tiff</span><span class="pun">.</span><span class="pln">datareaders</span><span class="pun">;</span><span class="pln"></span><br></li><li class="L7"><span class="pln"></span><br></li><li class="L8"><span class="pln"></span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">awt</span><span class="pun">.</span><span class="typ">Rectangle</span><span class="pun">;</span><span class="pln"></span><br></li><li class="L9"><span class="pln"></span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">io</span><span class="pun">.</span><span class="typ">ByteArrayInputStream</span><span class="pun">;</span><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">io</span><span class="pun">.</span><span class="typ">IOException</span><span class="pun">;</span><span class="pln"></span><br></li><li class="L1"><span class="pln"></span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">io</span><span class="pun">.</span><span class="typ">InputStream</span><span class="pun">;</span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">nio</span><span class="pun">.</span><span class="typ">ByteOrder</span><span class="pun">;</span><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="typ">Arrays</span><span class="pun">;</span><span class="pln"></span><br></li><li class="L4"><span class="pln"></span><br></li><li class="L5"><span class="pln"></span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">apache</span><span class="pun">.</span><span class="pln">commons</span><span class="pun">.</span><span class="pln">imaging</span><span class="pun">.</span><span class="typ">ImagingException</span><span class="pun">;</span><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">apache</span><span class="pun">.</span><span class="pln">commons</span><span class="pun">.</span><span class="pln">imaging</span><span class="pun">.</span><span class="pln">common</span><span class="pun">.</span><span class="typ">Allocator</span><span class="pun">;</span><span class="pln"></span><br></li><li class="L7"><span class="pln"></span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">apache</span><span class="pun">.</span><span class="pln">commons</span><span class="pun">.</span><span class="pln">imaging</span><span class="pun">.</span><span class="pln">common</span><span class="pun">.</span><span class="typ">ImageBuilder</span><span class="pun">;</span><span class="pln"></span><br></li><li class="L8"><span class="pln"></span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">apache</span><span class="pun">.</span><span class="pln">commons</span><span class="pun">.</span><span class="pln">imaging</span><span class="pun">.</span><span class="pln">common</span><span class="pun">.</span><span class="typ">PackBits</span><span class="pun">;</span><span class="pln"></span><br></li><li class="L9"><span class="pln"></span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">apache</span><span class="pun">.</span><span class="pln">commons</span><span class="pun">.</span><span class="pln">imaging</span><span class="pun">.</span><span class="pln">common</span><span class="pun">.</span><span class="typ">ZlibDeflate</span><span class="pun">;</span><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">apache</span><span class="pun">.</span><span class="pln">commons</span><span class="pun">.</span><span class="pln">imaging</span><span class="pun">.</span><span class="pln">formats</span><span class="pun">.</span><span class="pln">tiff</span><span class="pun">.</span><span class="typ">AbstractTiffRasterData</span><span class="pun">;</span><span class="pln"></span><br></li><li class="L1"><span class="pln"></span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">apache</span><span class="pun">.</span><span class="pln">commons</span><span class="pun">.</span><span class="pln">imaging</span><span class="pun">.</span><span class="pln">formats</span><span class="pun">.</span><span class="pln">tiff</span><span class="pun">.</span><span class="typ">TiffDirectory</span><span class="pun">;</span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">apache</span><span class="pun">.</span><span class="pln">commons</span><span class="pun">.</span><span class="pln">imaging</span><span class="pun">.</span><span class="pln">formats</span><span class="pun">.</span><span class="pln">tiff</span><span class="pun">.</span><span class="typ">TiffField</span><span class="pun">;</span><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">apache</span><span class="pun">.</span><span class="pln">commons</span><span class="pun">.</span><span class="pln">imaging</span><span class="pun">.</span><span class="pln">formats</span><span class="pun">.</span><span class="pln">tiff</span><span class="pun">.</span><span class="pln">constants</span><span class="pun">.</span><span class="typ">TiffConstants</span><span class="pun">;</span><span class="pln"></span><br></li><li class="L4"><span class="pln"></span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">apache</span><span class="pun">.</span><span class="pln">commons</span><span class="pun">.</span><span class="pln">imaging</span><span class="pun">.</span><span class="pln">formats</span><span class="pun">.</span><span class="pln">tiff</span><span class="pun">.</span><span class="pln">constants</span><span class="pun">.</span><span class="typ">TiffPlanarConfiguration</span><span class="pun">;</span><span class="pln"></span><br></li><li class="L5"><span class="pln"></span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">apache</span><span class="pun">.</span><span class="pln">commons</span><span class="pun">.</span><span class="pln">imaging</span><span class="pun">.</span><span class="pln">formats</span><span class="pun">.</span><span class="pln">tiff</span><span class="pun">.</span><span class="pln">constants</span><span class="pun">.</span><span class="typ">TiffTagConstants</span><span class="pun">;</span><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">apache</span><span class="pun">.</span><span class="pln">commons</span><span class="pun">.</span><span class="pln">imaging</span><span class="pun">.</span><span class="pln">formats</span><span class="pun">.</span><span class="pln">tiff</span><span class="pun">.</span><span class="pln">itu_t4</span><span class="pun">.</span><span class="pln">T4AndT6Compression</span><span class="pun">;</span><span class="pln"></span><br></li><li class="L7"><span class="pln"></span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">apache</span><span class="pun">.</span><span class="pln">commons</span><span class="pun">.</span><span class="pln">imaging</span><span class="pun">.</span><span class="pln">formats</span><span class="pun">.</span><span class="pln">tiff</span><span class="pun">.</span><span class="pln">photometricinterpreters</span><span class="pun">.</span><span class="typ">AbstractPhotometricInterpreter</span><span class="pun">;</span><span class="pln"></span><br></li><li class="L8"><span class="pln"></span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">apache</span><span class="pun">.</span><span class="pln">commons</span><span class="pun">.</span><span class="pln">imaging</span><span class="pun">.</span><span class="pln">mylzw</span><span class="pun">.</span><span class="typ">MyLzwDecompressor</span><span class="pun">;</span><span class="pln"></span><br></li><li class="L9"><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="com">/**</span><br></li><li class="L1"><span class="com">&nbsp;* Defines the base class for the TIFF file reader classes. The TIFF format defines two broad organizations for image pixel storage: strips and tiles. This</span><br></li><li class="L2"><span class="com">&nbsp;* class defines common elements for both representations.</span><br></li><li class="L3"><span class="com">&nbsp;* &lt;p&gt;</span><br></li><li class="L4"><span class="com">&nbsp;* &lt;strong&gt;The TIFF Floating-Point Formats &lt;/strong&gt;</span><br></li><li class="L5"><span class="com">&nbsp;* &lt;p&gt;</span><br></li><li class="L6"><span class="com">&nbsp;* In addition to providing images, TIFF files can supply data in the form of numerical values. As of March 2020 the Commons Imaging library was extended to</span><br></li><li class="L7"><span class="com">&nbsp;* support some floating-point data formats.</span><br></li><li class="L8"><span class="com">&nbsp;* &lt;p&gt;</span><br></li><li class="L9"><span class="com">&nbsp;* Unfortunately, the TIFF floating-point format allows for a lot of different variations. At this time, only the most widely used of these are supported. When</span><br></li><li class="L0"><span class="com">&nbsp;* this code was written, only a small set of test data products were available. Thus it is likely that developers will wish to extend the range of</span><br></li><li class="L1"><span class="com">&nbsp;* floating-point data that can be processed as additional test data become available. When implementing extensions to this logic, developers are reminded that</span><br></li><li class="L2"><span class="com">&nbsp;* image processing requires the handling of literally millions of pixels, so attention to performance is essential to a successful implementation (please see</span><br></li><li class="L3"><span class="com">&nbsp;* the notes in {@link DataReaderStrips} for more information).</span><br></li><li class="L4"><span class="com">&nbsp;* &lt;p&gt;</span><br></li><li class="L5"><span class="com">&nbsp;* The TIFF floating-point specification is poorly documented. So these notes are included to provide clarification on at least some aspects of the format. Some</span><br></li><li class="L6"><span class="com">&nbsp;* documentation and C-code examples are available in "TIFF Technical Note 3, April 8, 2005)".</span><br></li><li class="L7"><span class="com">&nbsp;* &lt;p&gt;</span><br></li><li class="L8"><span class="com">&nbsp;* &lt;strong&gt;The Predictor==3 Case&lt;/strong&gt;</span><br></li><li class="L9"><span class="com">&nbsp;* &lt;p&gt;</span><br></li><li class="L0"><span class="com">&nbsp;* TIFF specifies an extension for a predictor that is intended to improve data compression ratios for floating-point values. This predictor is specified using</span><br></li><li class="L1"><span class="com">&nbsp;* the TIFF predictor TAG with a value of 3 (see TIFF Technical Note 3). Consider a 4-byte floating point value given in IEEE-754 format. Let f3 be the</span><br></li><li class="L2"><span class="com">&nbsp;* high-order byte, with f2 the next highest, followed by f1, and f0 for the low-order byte. This designation should not be confused with the in-memory layout</span><br></li><li class="L3"><span class="com">&nbsp;* of the bytes (little-endian versus big-endian), but rather their numerical values. The sign bit and upper 7 bits of the exponent are given in the high-order</span><br></li><li class="L4"><span class="com">&nbsp;* byte, followed by the one remaining exponent bit and the mantissa in the lower-order bytes.</span><br></li><li class="L5"><span class="com">&nbsp;* &lt;p&gt;</span><br></li><li class="L6"><span class="com">&nbsp;* In many real-valued raster data sets, the sign and magnitude (exponent) of the values change slowly. But the bits in the mantissa vary rapidly in a</span><br></li><li class="L7"><span class="com">&nbsp;* semi-random manner. The information entropy in the mantissa tends to increase in the lowest ordered bytes. Thus, the high-order bytes have more redundancy</span><br></li><li class="L8"><span class="com">&nbsp;* than the low-order bytes and can compress more efficiently. To exploit this, the TIFF format splits the bytes into groups based on their order-of-magnitude.</span><br></li><li class="L9"><span class="com">&nbsp;* This splitting process takes place on a ROW-BY-ROW basis (note the emphasis, this point is not clearly documented in the spec). For example, for a row of</span><br></li><li class="L0"><span class="com">&nbsp;* length 3 pixels -- A, B, and C -- the data for two rows would be given as shown below (again, ignoring endian issues):</span><br></li><li class="L1"><span class="com">&nbsp;*</span><br></li><li class="L2"><span class="com">&nbsp;* &lt;pre&gt;</span><br></li><li class="L3"><span class="com">&nbsp;* &nbsp; Original:</span><br></li><li class="L4"><span class="com">&nbsp;* &nbsp; &nbsp; &nbsp;A3 A2 A1 A0 &nbsp; B3 B2 B1 B0 &nbsp; C3 C2 C1 C0</span><br></li><li class="L5"><span class="com">&nbsp;* &nbsp; &nbsp; &nbsp;D3 D3 D1 D0 &nbsp; E3 E2 E2 E0 &nbsp; F3 F2 F1 F0</span><br></li><li class="L6"><span class="com">&nbsp;*</span><br></li><li class="L7"><span class="com">&nbsp;* &nbsp; Bytes split into groups by order-of-magnitude:</span><br></li><li class="L8"><span class="com">&nbsp;* &nbsp; &nbsp; &nbsp;A3 B3 C3 &nbsp; A2 B2 C2 &nbsp; A1 B1 C1 &nbsp; A0 B0 C0</span><br></li><li class="L9"><span class="com">&nbsp;* &nbsp; &nbsp; &nbsp;D3 E3 F3 &nbsp; D2 E2 F2 &nbsp; D1 E1 F1 &nbsp; D0 E0 F0</span><br></li><li class="L0"><span class="com">&nbsp;* &lt;/pre&gt;</span><br></li><li class="L1"><span class="com">&nbsp;*</span><br></li><li class="L2"><span class="com">&nbsp;* To further improve the compression, the predictor takes the difference of each subsequent bytes. Again, the differences (deltas) are computed on a</span><br></li><li class="L3"><span class="com">&nbsp;* row-byte-row basis. For the most part, the differences combine bytes associated with the same order-of-magnitude, though there is a special transition at the</span><br></li><li class="L4"><span class="com">&nbsp;* end of each order-of-magnitude set (shown in parentheses):</span><br></li><li class="L5"><span class="com">&nbsp;*</span><br></li><li class="L6"><span class="com">&nbsp;* &lt;pre&gt;</span><br></li><li class="L7"><span class="com">&nbsp;* &nbsp; &nbsp; &nbsp;A3, B3-A3, C3-B3, (A2-C3), B2-A2, C2-B2, (A1-C2), etc.</span><br></li><li class="L8"><span class="com">&nbsp;* &nbsp; &nbsp; &nbsp;D3, E3-D3, F3-D3, (D2-F3), E3-D2, etc.</span><br></li><li class="L9"><span class="com">&nbsp;* &lt;/pre&gt;</span><br></li><li class="L0"><span class="com">&nbsp;*</span><br></li><li class="L1"><span class="com">&nbsp;* Once the predictor transform is complete, the data is stored using conventional data compression techniques such as Deflate or LZW. In practice, floating</span><br></li><li class="L2"><span class="com">&nbsp;* point data does not compress especially well, but using the above technique, the TIFF process typically reduces the overall storage size by 20 to 30 percent</span><br></li><li class="L3"><span class="com">&nbsp;* (depending on the data). The TIFF Technical Note 3 specifies 3 data size formats for storing floating point values:</span><br></li><li class="L4"><span class="com">&nbsp;*</span><br></li><li class="L5"><span class="com">&nbsp;* &lt;pre&gt;</span><br></li><li class="L6"><span class="com">&nbsp;* &nbsp; &nbsp; 32 bits &nbsp; &nbsp;IEEE-754 single-precision standard</span><br></li><li class="L7"><span class="com">&nbsp;* &nbsp; &nbsp; 16 bits &nbsp; &nbsp;IEEE-754 half-precision standard</span><br></li><li class="L8"><span class="com">&nbsp;* &nbsp; &nbsp; 24 bits &nbsp; &nbsp;A non-standard representation</span><br></li><li class="L9"><span class="com">&nbsp;* &lt;/pre&gt;</span><br></li><li class="L0"><span class="com">&nbsp;*</span><br></li><li class="L1"><span class="com">&nbsp;* At this time, we have not obtained data samples for the smaller representations used in combination with a predictor.</span><br></li><li class="L2"><span class="com">&nbsp;* &lt;p&gt;</span><br></li><li class="L3"><span class="com">&nbsp;* &lt;strong&gt;Interleaved formats&lt;/strong&gt;</span><br></li><li class="L4"><span class="com">&nbsp;* &lt;p&gt;</span><br></li><li class="L5"><span class="com">&nbsp;* TIFF Technical Note 3 also provides example code for cases where each pixel (or raster cell) in the image is associated with more than one floating-point</span><br></li><li class="L6"><span class="com">&nbsp;* samples. Data in this format might be used for real-valued vector data, complex-valued pairs, or other numerical applications).</span><br></li><li class="L7"><span class="com">&nbsp;* &lt;p&gt;</span><br></li><li class="L8"><span class="com">&nbsp;* At this time, we have encountered only a limited selection of the possible configurations for multi-variable data. The code below only supports those</span><br></li><li class="L9"><span class="com">&nbsp;* configurations for which we had actual images that could be used to verify our implementation. The implementation supports the following formats:</span><br></li><li class="L0"><span class="com">&nbsp;* &lt;ul&gt;</span><br></li><li class="L1"><span class="com">&nbsp;* &lt;li&gt;32-bit floating-point data&lt;/li&gt;</span><br></li><li class="L2"><span class="com">&nbsp;* &lt;li&gt;Uncompressed, Deflate, or LZW compression&lt;/li&gt;</span><br></li><li class="L3"><span class="com">&nbsp;* &lt;li&gt;Optional horizontal predictors used with compression&lt;/li&gt;</span><br></li><li class="L4"><span class="com">&nbsp;* &lt;li&gt;PlanarConfiguration interleaved (CHUNKY) or non-interleaved (PLANAR)&lt;/li&gt;</span><br></li><li class="L5"><span class="com">&nbsp;* &lt;/ul&gt;</span><br></li><li class="L6"><span class="com">&nbsp;* &lt;p&gt;</span><br></li><li class="L7"><span class="com">&nbsp;* Note that integer formats are not supported at this time.</span><br></li><li class="L8"><span class="com">&nbsp;* &lt;p&gt;</span><br></li><li class="L9"><span class="com">&nbsp;* Often, the TIFF files store multi-variable data in so that samples are interleaved. For example, a configuration that gave two samples per pixel (or cell)</span><br></li><li class="L0"><span class="com">&nbsp;* would give the two values for the first pixel in order followed by the two values for the second pixel, etc. If a differencing approach were used for data</span><br></li><li class="L1"><span class="com">&nbsp;* compression, the byte-stream would begin with the high-order byte for each of the two samples for the first pixel, followed by the high-order byte for each</span><br></li><li class="L2"><span class="com">&nbsp;* of the next two samples, and so forth for the remainder of the row of pixels. It would then follow with the second-highest-order bytes for the first two</span><br></li><li class="L3"><span class="com">&nbsp;* samples, etc.</span><br></li><li class="L4"><span class="com">&nbsp;* &lt;p&gt;</span><br></li><li class="L5"><span class="com">&nbsp;* This implementation also supports the non-interleaved (PLANAR) configuration. One consideration in implementing this feature was that TIFF Technical Note 3</span><br></li><li class="L6"><span class="com">&nbsp;* does not address the case where a TIFF image uses the alternate planar configuration. For conventional images, the TIFF specification (Revision 6.0)</span><br></li><li class="L7"><span class="com">&nbsp;* recommends that the planar configuration should be avoided (see pg. 38). But for numerical data products, the planar configuration may yield better data</span><br></li><li class="L8"><span class="com">&nbsp;* compression in the case where different sample sets have different statistical properties. Because separated groups often have more uniformity and</span><br></li><li class="L9"><span class="com">&nbsp;* predictability than interleaved data sets, they sometimes lead to a small improvement in storage-size reduction when data compression is used.</span><br></li><li class="L0"><span class="com">&nbsp;*/</span><span class="pln"></span><br></li><li class="L1"><span class="pln"></span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">abstract</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">AbstractImageDataReader</span><span class="pln"> </span><span class="pun">{</span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><br></li><li class="L3"><span class="pln">&nbsp; &nbsp; </span><span class="com">/** The TIFF directory containing the image data. */</span><span class="pln"></span><br></li><li class="L4"><span class="pln">&nbsp; &nbsp; </span><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">TiffDirectory</span><span class="pln"> directory</span><span class="pun">;</span><span class="pln"></span><br></li><li class="L5"><span class="pln"></span><br></li><li class="L6"><span class="pln">&nbsp; &nbsp; </span><span class="com">/** The photometric interpreter for the image. */</span><span class="pln"></span><br></li><li class="L7"><span class="pln">&nbsp; &nbsp; </span><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">AbstractPhotometricInterpreter</span><span class="pln"> photometricInterpreter</span><span class="pun">;</span><span class="pln"></span><br></li><li class="L8"><span class="pln"></span><br></li><li class="L9"><span class="pln">&nbsp; &nbsp; </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">[]</span><span class="pln"> bitsPerSample</span><span class="pun">;</span><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><br></li><li class="L1"><span class="pln">&nbsp; &nbsp; </span><span class="com">/** The length of the bitsPerSample array. */</span><span class="pln"></span><br></li><li class="L2"><span class="pln">&nbsp; &nbsp; </span><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> bitsPerSampleLength</span><span class="pun">;</span><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><br></li><li class="L4"><span class="pln">&nbsp; &nbsp; </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">[]</span><span class="pln"> last</span><span class="pun">;</span><span class="pln"></span><br></li><li class="L5"><span class="pln"></span><br></li><li class="L6"><span class="pln">&nbsp; &nbsp; </span><span class="com">/** The predictor value for data compression. */</span><span class="pln"></span><br></li><li class="L7"><span class="pln">&nbsp; &nbsp; </span><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> predictor</span><span class="pun">;</span><span class="pln"></span><br></li><li class="L8"><span class="pln"></span><br></li><li class="L9"><span class="pln">&nbsp; &nbsp; </span><span class="com">/** The number of samples per pixel. */</span><span class="pln"></span><br></li><li class="L0"><span class="pln">&nbsp; &nbsp; </span><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> samplesPerPixel</span><span class="pun">;</span><span class="pln"></span><br></li><li class="L1"><span class="pln"></span><br></li><li class="L2"><span class="pln">&nbsp; &nbsp; </span><span class="com">/** The width of the image. */</span><span class="pln"></span><br></li><li class="L3"><span class="pln">&nbsp; &nbsp; </span><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> width</span><span class="pun">;</span><span class="pln"></span><br></li><li class="L4"><span class="pln"></span><br></li><li class="L5"><span class="pln">&nbsp; &nbsp; </span><span class="com">/** The height of the image. */</span><span class="pln"></span><br></li><li class="L6"><span class="pln">&nbsp; &nbsp; </span><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> height</span><span class="pun">;</span><span class="pln"></span><br></li><li class="L7"><span class="pln"></span><br></li><li class="L8"><span class="pln">&nbsp; &nbsp; </span><span class="com">/** The sample format. */</span><span class="pln"></span><br></li><li class="L9"><span class="pln">&nbsp; &nbsp; </span><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> sampleFormat</span><span class="pun">;</span><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><br></li><li class="L1"><span class="pln">&nbsp; &nbsp; </span><span class="com">/** The planar configuration of the image. */</span><span class="pln"></span><br></li><li class="L2"><span class="pln">&nbsp; &nbsp; </span><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">TiffPlanarConfiguration</span><span class="pln"> planarConfiguration</span><span class="pun">;</span><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><br></li><li class="L4"><span class="pln">&nbsp; &nbsp; </span><span class="com">/**</span><br></li><li class="L5"><span class="com">&nbsp; &nbsp; &nbsp;* Constructs a new image data reader.</span><br></li><li class="L6"><span class="com">&nbsp; &nbsp; &nbsp;*</span><br></li><li class="L7"><span class="com">&nbsp; &nbsp; &nbsp;* @param directory the TIFF directory.</span><br></li><li class="L8"><span class="com">&nbsp; &nbsp; &nbsp;* @param photometricInterpreter the photometric interpreter.</span><br></li><li class="L9"><span class="com">&nbsp; &nbsp; &nbsp;* @param bitsPerSample the bits per sample array.</span><br></li><li class="L0"><span class="com">&nbsp; &nbsp; &nbsp;* @param predictor the predictor value.</span><br></li><li class="L1"><span class="com">&nbsp; &nbsp; &nbsp;* @param samplesPerPixel the number of samples per pixel.</span><br></li><li class="L2"><span class="com">&nbsp; &nbsp; &nbsp;* @param sampleFormat the sample format.</span><br></li><li class="L3"><span class="com">&nbsp; &nbsp; &nbsp;* @param width the image width.</span><br></li><li class="L4"><span class="com">&nbsp; &nbsp; &nbsp;* @param height the image height.</span><br></li><li class="L5"><span class="com">&nbsp; &nbsp; &nbsp;* @param planarConfiguration the planar configuration.</span><br></li><li class="L6"><span class="com">&nbsp; &nbsp; &nbsp;*/</span><span class="pln"></span><br></li><li class="L7"><span class="pln">&nbsp; &nbsp; </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">AbstractImageDataReader</span><span class="pun">(</span><span class="kwd">final</span><span class="pln"> </span><span class="typ">TiffDirectory</span><span class="pln"> directory</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">AbstractPhotometricInterpreter</span><span class="pln"> photometricInterpreter</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">[]</span><span class="pln"> bitsPerSample</span><span class="pun">,</span><span class="pln"></span><br></li><li class="L8"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> predictor</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> samplesPerPixel</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> sampleFormat</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> width</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> height</span><span class="pun">,</span><span class="pln"></span><br></li><li class="L9"><span class="pln"></span><span class="fc" id="L180"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">TiffPlanarConfiguration</span><span class="pln"> planarConfiguration</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="fc" id="L181"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">directory </span><span class="pun">=</span><span class="pln"> directory</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L1"><span class="pln"></span><span class="fc" id="L182"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">photometricInterpreter </span><span class="pun">=</span><span class="pln"> photometricInterpreter</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><span class="fc" id="L183"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">bitsPerSample </span><span class="pun">=</span><span class="pln"> bitsPerSample</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><span class="fc" id="L184"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">bitsPerSampleLength </span><span class="pun">=</span><span class="pln"> bitsPerSample</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L4"><span class="pln"></span><span class="fc" id="L185"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">samplesPerPixel </span><span class="pun">=</span><span class="pln"> samplesPerPixel</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L5"><span class="pln"></span><span class="fc" id="L186"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">sampleFormat </span><span class="pun">=</span><span class="pln"> sampleFormat</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><span class="fc" id="L187"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">predictor </span><span class="pun">=</span><span class="pln"> predictor</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L7"><span class="pln"></span><span class="fc" id="L188"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">width </span><span class="pun">=</span><span class="pln"> width</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L8"><span class="pln"></span><span class="fc" id="L189"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">height </span><span class="pun">=</span><span class="pln"> height</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L9"><span class="pln"></span><span class="fc" id="L190"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">planarConfiguration </span><span class="pun">=</span><span class="pln"> planarConfiguration</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="fc" id="L191"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; last </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Allocator</span><span class="pun">.</span><span class="pln">intArray</span><span class="pun">(</span><span class="pln">samplesPerPixel</span><span class="pun">);</span></span><span class="pln"></span><br></li><li class="L1"><span class="pln"></span><span class="fc" id="L192"><span class="pln">&nbsp; &nbsp; </span><span class="pun">}</span></span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><br></li><li class="L3"><span class="pln">&nbsp; &nbsp; </span><span class="com">/**</span><br></li><li class="L4"><span class="com">&nbsp; &nbsp; &nbsp;* Applies the predictor to the samples.</span><br></li><li class="L5"><span class="com">&nbsp; &nbsp; &nbsp;*</span><br></li><li class="L6"><span class="com">&nbsp; &nbsp; &nbsp;* @param samples the samples array.</span><br></li><li class="L7"><span class="com">&nbsp; &nbsp; &nbsp;* @return the modified samples array.</span><br></li><li class="L8"><span class="com">&nbsp; &nbsp; &nbsp;*/</span><span class="pln"></span><br></li><li class="L9"><span class="pln">&nbsp; &nbsp; </span><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">[]</span><span class="pln"> applyPredictor</span><span class="pun">(</span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">[]</span><span class="pln"> samples</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="fc bfc" id="L201" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">predictor </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L1"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// Horizontal differencing.</span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><span class="fc bfc" id="L203" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> samples</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><span class="fc" id="L204"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; samples</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0xff</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> samples</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> last</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span></span><span class="pln"></span><br></li><li class="L4"><span class="pln"></span><span class="fc" id="L205"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; last</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> samples</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span></span><span class="pln"></span><br></li><li class="L5"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L6"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L7"><span class="pln"></span><br></li><li class="L8"><span class="pln"></span><span class="fc" id="L209"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> samples</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L9"><span class="pln">&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><br></li><li class="L1"><span class="pln">&nbsp; &nbsp; </span><span class="com">/**</span><br></li><li class="L2"><span class="com">&nbsp; &nbsp; &nbsp;* Applies the predictor to a block of data.</span><br></li><li class="L3"><span class="com">&nbsp; &nbsp; &nbsp;*</span><br></li><li class="L4"><span class="com">&nbsp; &nbsp; &nbsp;* @param width the block width.</span><br></li><li class="L5"><span class="com">&nbsp; &nbsp; &nbsp;* @param height the block height.</span><br></li><li class="L6"><span class="com">&nbsp; &nbsp; &nbsp;* @param nSamplesPerPixel the number of samples per pixel.</span><br></li><li class="L7"><span class="com">&nbsp; &nbsp; &nbsp;* @param p the data block.</span><br></li><li class="L8"><span class="com">&nbsp; &nbsp; &nbsp;*/</span><span class="pln"></span><br></li><li class="L9"><span class="pln">&nbsp; &nbsp; </span><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> applyPredictorToBlock</span><span class="pun">(</span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> width</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> height</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> nSamplesPerPixel</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">byte</span><span class="pun">[]</span><span class="pln"> p</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="fc" id="L221"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> k </span><span class="pun">=</span><span class="pln"> width </span><span class="pun">*</span><span class="pln"> nSamplesPerPixel</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L1"><span class="pln"></span><span class="fc bfc" id="L222" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> height</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><span class="fc" id="L223"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> j0 </span><span class="pun">=</span><span class="pln"> i </span><span class="pun">*</span><span class="pln"> k </span><span class="pun">+</span><span class="pln"> nSamplesPerPixel</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><span class="fc" id="L224"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> j1 </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> k</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L4"><span class="pln"></span><span class="fc bfc" id="L225" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> j0</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;</span><span class="pln"> j1</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L5"><span class="pln"></span><span class="fc" id="L226"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> p</span><span class="pun">[</span><span class="pln">j </span><span class="pun">-</span><span class="pln"> nSamplesPerPixel</span><span class="pun">];</span></span><span class="pln"></span><br></li><li class="L6"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L7"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L8"><span class="pln"></span><span class="fc" id="L229"><span class="pln">&nbsp; &nbsp; </span><span class="pun">}</span></span><span class="pln"></span><br></li><li class="L9"><span class="pln"></span><br></li><li class="L0"><span class="pln">&nbsp; &nbsp; </span><span class="com">/**</span><br></li><li class="L1"><span class="com">&nbsp; &nbsp; &nbsp;* Decompresses compressed image data.</span><br></li><li class="L2"><span class="com">&nbsp; &nbsp; &nbsp;*</span><br></li><li class="L3"><span class="com">&nbsp; &nbsp; &nbsp;* @param compressedInput the compressed input data.</span><br></li><li class="L4"><span class="com">&nbsp; &nbsp; &nbsp;* @param compression the compression type.</span><br></li><li class="L5"><span class="com">&nbsp; &nbsp; &nbsp;* @param expectedSize the expected size of the decompressed data.</span><br></li><li class="L6"><span class="com">&nbsp; &nbsp; &nbsp;* @param tileWidth the tile width.</span><br></li><li class="L7"><span class="com">&nbsp; &nbsp; &nbsp;* @param tileHeight the tile height.</span><br></li><li class="L8"><span class="com">&nbsp; &nbsp; &nbsp;* @return the decompressed data.</span><br></li><li class="L9"><span class="com">&nbsp; &nbsp; &nbsp;* @throws ImagingException if the image format is invalid.</span><br></li><li class="L0"><span class="com">&nbsp; &nbsp; &nbsp;* @throws IOException if an I/O error occurs.</span><br></li><li class="L1"><span class="com">&nbsp; &nbsp; &nbsp;*/</span><span class="pln"></span><br></li><li class="L2"><span class="pln">&nbsp; &nbsp; </span><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">byte</span><span class="pun">[]</span><span class="pln"> decompress</span><span class="pun">(</span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">byte</span><span class="pun">[]</span><span class="pln"> compressedInput</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> compression</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> expectedSize</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> tileWidth</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> tileHeight</span><span class="pun">)</span><span class="pln"></span><br></li><li class="L3"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">throws</span><span class="pln"> </span><span class="typ">ImagingException</span><span class="pun">,</span><span class="pln"> </span><span class="typ">IOException</span><span class="pln"> </span><span class="pun">{</span><span class="pln"></span><br></li><li class="L4"><span class="pln"></span><span class="fc" id="L245"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">TiffField</span><span class="pln"> fillOrderField </span><span class="pun">=</span><span class="pln"> directory</span><span class="pun">.</span><span class="pln">findField</span><span class="pun">(</span><span class="typ">TiffTagConstants</span><span class="pun">.</span><span class="pln">TIFF_TAG_FILL_ORDER</span><span class="pun">);</span></span><span class="pln"></span><br></li><li class="L5"><span class="pln"></span><span class="fc" id="L246"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">int</span><span class="pln"> fillOrder </span><span class="pun">=</span><span class="pln"> </span><span class="typ">TiffTagConstants</span><span class="pun">.</span><span class="pln">FILL_ORDER_VALUE_NORMAL</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><span class="fc bfc" id="L247" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">fillOrderField </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L7"><span class="pln"></span><span class="fc" id="L248"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fillOrder </span><span class="pun">=</span><span class="pln"> fillOrderField</span><span class="pun">.</span><span class="pln">getIntValue</span><span class="pun">();</span></span><span class="pln"></span><br></li><li class="L8"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L9"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">byte</span><span class="pun">[]</span><span class="pln"> compressedOrdered</span><span class="pun">;</span><span class="pln"> </span><span class="com">// re-ordered bytes (if necessary)</span><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="pc bpc" id="L251" title="1 of 2 branches missed."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">fillOrder </span><span class="pun">==</span><span class="pln"> </span><span class="typ">TiffTagConstants</span><span class="pun">.</span><span class="pln">FILL_ORDER_VALUE_NORMAL</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L1"><span class="pln"></span><span class="fc" id="L252"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; compressedOrdered </span><span class="pun">=</span><span class="pln"> compressedInput</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L2"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// good</span><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><span class="nc bnc" id="L254" title="All 2 branches missed."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">fillOrder </span><span class="pun">==</span><span class="pln"> </span><span class="typ">TiffTagConstants</span><span class="pun">.</span><span class="pln">FILL_ORDER_VALUE_REVERSED</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L4"><span class="pln"></span><span class="nc" id="L255"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; compressedOrdered </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="kwd">byte</span><span class="pun">[</span><span class="pln">compressedInput</span><span class="pun">.</span><span class="pln">length</span><span class="pun">];</span></span><span class="pln"></span><br></li><li class="L5"><span class="pln"></span><span class="nc bnc" id="L256" title="All 2 branches missed."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> compressedInput</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><span class="nc" id="L257"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; compressedOrdered</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">byte</span><span class="pun">)</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Integer</span><span class="pun">.</span><span class="pln">reverse</span><span class="pun">(</span><span class="lit">0xff</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> compressedInput</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">&gt;&gt;&gt;</span><span class="pln"> </span><span class="lit">24</span><span class="pun">);</span></span><span class="pln"></span><br></li><li class="L7"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L8"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln"></span><br></li><li class="L9"><span class="pln"></span><span class="nc" id="L260"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ImagingException</span><span class="pun">(</span><span class="str">"TIFF FillOrder="</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> fillOrder </span><span class="pun">+</span><span class="pln"> </span><span class="str">" is invalid"</span><span class="pun">);</span></span><span class="pln"></span><br></li><li class="L0"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L1"><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><span class="pc bpc" id="L263" title="1 of 8 branches missed."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">switch</span><span class="pln"> </span><span class="pun">(</span><span class="pln">compression</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L3"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">case</span><span class="pln"> </span><span class="typ">TiffConstants</span><span class="pun">.</span><span class="pln">COMPRESSION_UNCOMPRESSED</span><span class="pun">:</span><span class="pln"></span><br></li><li class="L4"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// None;</span><span class="pln"></span><br></li><li class="L5"><span class="pln"></span><span class="fc" id="L266"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> compressedOrdered</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L6"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">case</span><span class="pln"> </span><span class="typ">TiffConstants</span><span class="pun">.</span><span class="pln">COMPRESSION_CCITT_1D</span><span class="pun">:</span><span class="pln"></span><br></li><li class="L7"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// CCITT Group 3 1-Dimensional Modified Huffman run-length encoding.</span><span class="pln"></span><br></li><li class="L8"><span class="pln"></span><span class="fc" id="L269"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> T4AndT6Compression</span><span class="pun">.</span><span class="pln">decompressModifiedHuffman</span><span class="pun">(</span><span class="pln">compressedOrdered</span><span class="pun">,</span><span class="pln"> tileWidth</span><span class="pun">,</span><span class="pln"> tileHeight</span><span class="pun">);</span></span><span class="pln"></span><br></li><li class="L9"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">case</span><span class="pln"> </span><span class="typ">TiffConstants</span><span class="pun">.</span><span class="pln">COMPRESSION_CCITT_GROUP_3</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="fc" id="L271"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">int</span><span class="pln"> t4Options </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L1"><span class="pln"></span><span class="fc" id="L272"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">TiffField</span><span class="pln"> field </span><span class="pun">=</span><span class="pln"> directory</span><span class="pun">.</span><span class="pln">findField</span><span class="pun">(</span><span class="typ">TiffTagConstants</span><span class="pun">.</span><span class="pln">TIFF_TAG_T4_OPTIONS</span><span class="pun">);</span></span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><span class="fc bfc" id="L273" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">field </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><span class="fc" id="L274"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; t4Options </span><span class="pun">=</span><span class="pln"> field</span><span class="pun">.</span><span class="pln">getIntValue</span><span class="pun">();</span></span><span class="pln"></span><br></li><li class="L4"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L5"><span class="pln"></span><span class="fc bfc" id="L276" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> is2D </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">t4Options </span><span class="pun">&amp;</span><span class="pln"> </span><span class="typ">TiffConstants</span><span class="pun">.</span><span class="pln">FLAG_T4_OPTIONS_2D</span><span class="pun">)</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><span class="pc bpc" id="L277" title="1 of 2 branches missed."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> usesUncompressedMode </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">t4Options </span><span class="pun">&amp;</span><span class="pln"> </span><span class="typ">TiffConstants</span><span class="pun">.</span><span class="pln">FLAG_T4_OPTIONS_UNCOMPRESSED_MODE</span><span class="pun">)</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L7"><span class="pln"></span><span class="pc bpc" id="L278" title="1 of 2 branches missed."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">usesUncompressedMode</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L8"><span class="pln"></span><span class="nc" id="L279"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ImagingException</span><span class="pun">(</span><span class="str">"T.4 compression with the uncompressed mode extension is not yet supported"</span><span class="pun">);</span></span><span class="pln"></span><br></li><li class="L9"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="fc bfc" id="L281" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> hasFillBitsBeforeEOL </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">t4Options </span><span class="pun">&amp;</span><span class="pln"> </span><span class="typ">TiffConstants</span><span class="pun">.</span><span class="pln">FLAG_T4_OPTIONS_FILL</span><span class="pun">)</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L1"><span class="pln"></span><span class="fc bfc" id="L282" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">is2D</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><span class="fc" id="L283"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> T4AndT6Compression</span><span class="pun">.</span><span class="pln">decompressT4_2D</span><span class="pun">(</span><span class="pln">compressedOrdered</span><span class="pun">,</span><span class="pln"> tileWidth</span><span class="pun">,</span><span class="pln"> tileHeight</span><span class="pun">,</span><span class="pln"> hasFillBitsBeforeEOL</span><span class="pun">);</span></span><span class="pln"></span><br></li><li class="L3"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L4"><span class="pln"></span><span class="fc" id="L285"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> T4AndT6Compression</span><span class="pun">.</span><span class="pln">decompressT4_1D</span><span class="pun">(</span><span class="pln">compressedOrdered</span><span class="pun">,</span><span class="pln"> tileWidth</span><span class="pun">,</span><span class="pln"> tileHeight</span><span class="pun">,</span><span class="pln"> hasFillBitsBeforeEOL</span><span class="pun">);</span></span><span class="pln"></span><br></li><li class="L5"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L6"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">case</span><span class="pln"> </span><span class="typ">TiffConstants</span><span class="pun">.</span><span class="pln">COMPRESSION_CCITT_GROUP_4</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln"></span><br></li><li class="L7"><span class="pln"></span><span class="fc" id="L288"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">int</span><span class="pln"> t6Options </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L8"><span class="pln"></span><span class="fc" id="L289"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">TiffField</span><span class="pln"> field </span><span class="pun">=</span><span class="pln"> directory</span><span class="pun">.</span><span class="pln">findField</span><span class="pun">(</span><span class="typ">TiffTagConstants</span><span class="pun">.</span><span class="pln">TIFF_TAG_T6_OPTIONS</span><span class="pun">);</span></span><span class="pln"></span><br></li><li class="L9"><span class="pln"></span><span class="pc bpc" id="L290" title="1 of 2 branches missed."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">field </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="nc" id="L291"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; t6Options </span><span class="pun">=</span><span class="pln"> field</span><span class="pun">.</span><span class="pln">getIntValue</span><span class="pun">();</span></span><span class="pln"></span><br></li><li class="L1"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><span class="pc bpc" id="L293" title="1 of 2 branches missed."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> usesUncompressedMode </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">t6Options </span><span class="pun">&amp;</span><span class="pln"> </span><span class="typ">TiffConstants</span><span class="pun">.</span><span class="pln">FLAG_T6_OPTIONS_UNCOMPRESSED_MODE</span><span class="pun">)</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><span class="pc bpc" id="L294" title="1 of 2 branches missed."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">usesUncompressedMode</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L4"><span class="pln"></span><span class="nc" id="L295"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ImagingException</span><span class="pun">(</span><span class="str">"T.6 compression with the uncompressed mode extension is not yet supported"</span><span class="pun">);</span></span><span class="pln"></span><br></li><li class="L5"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><span class="fc" id="L297"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> T4AndT6Compression</span><span class="pun">.</span><span class="pln">decompressT6</span><span class="pun">(</span><span class="pln">compressedOrdered</span><span class="pun">,</span><span class="pln"> tileWidth</span><span class="pun">,</span><span class="pln"> tileHeight</span><span class="pun">);</span></span><span class="pln"></span><br></li><li class="L7"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L8"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">case</span><span class="pln"> </span><span class="typ">TiffConstants</span><span class="pun">.</span><span class="pln">COMPRESSION_LZW</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln"></span><br></li><li class="L9"><span class="pln"></span><span class="fc" id="L300"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">InputStream</span><span class="pln"> is </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ByteArrayInputStream</span><span class="pun">(</span><span class="pln">compressedOrdered</span><span class="pun">);</span></span><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="fc" id="L301"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> lzwMinimumCodeSize </span><span class="pun">=</span><span class="pln"> </span><span class="lit">8</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L1"><span class="pln"></span><span class="fc" id="L302"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MyLzwDecompressor</span><span class="pun">(</span><span class="pln">lzwMinimumCodeSize</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ByteOrder</span><span class="pun">.</span><span class="pln">BIG_ENDIAN</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">).</span><span class="pln">decompress</span><span class="pun">(</span><span class="pln">is</span><span class="pun">,</span><span class="pln"> expectedSize</span><span class="pun">);</span></span><span class="pln"></span><br></li><li class="L2"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><br></li><li class="L4"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// Packbits</span><span class="pln"></span><br></li><li class="L5"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">case</span><span class="pln"> </span><span class="typ">TiffConstants</span><span class="pun">.</span><span class="pln">COMPRESSION_PACKBITS</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><span class="fc" id="L307"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">PackBits</span><span class="pun">.</span><span class="pln">decompress</span><span class="pun">(</span><span class="pln">compressedOrdered</span><span class="pun">,</span><span class="pln"> expectedSize</span><span class="pun">);</span></span><span class="pln"></span><br></li><li class="L7"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L8"><span class="pln"></span><br></li><li class="L9"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// deflate</span><span class="pln"></span><br></li><li class="L0"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">case</span><span class="pln"> </span><span class="typ">TiffConstants</span><span class="pun">.</span><span class="pln">COMPRESSION_DEFLATE_ADOBE</span><span class="pun">:</span><span class="pln"></span><br></li><li class="L1"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">case</span><span class="pln"> </span><span class="typ">TiffConstants</span><span class="pun">.</span><span class="pln">COMPRESSION_DEFLATE_PKZIP</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><span class="fc" id="L313"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">ZlibDeflate</span><span class="pun">.</span><span class="pln">decompress</span><span class="pun">(</span><span class="pln">compressedInput</span><span class="pun">,</span><span class="pln"> expectedSize</span><span class="pun">);</span></span><span class="pln"></span><br></li><li class="L3"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L4"><span class="pln"></span><br></li><li class="L5"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">default</span><span class="pun">:</span><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><span class="nc" id="L317"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ImagingException</span><span class="pun">(</span><span class="str">"Tiff: unknown/unsupported compression: "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> compression</span><span class="pun">);</span></span><span class="pln"></span><br></li><li class="L7"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L8"><span class="pln">&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L9"><span class="pln"></span><br></li><li class="L0"><span class="pln">&nbsp; &nbsp; </span><span class="com">/**</span><br></li><li class="L1"><span class="com">&nbsp; &nbsp; &nbsp;* Reads samples and returns them in an int array.</span><br></li><li class="L2"><span class="com">&nbsp; &nbsp; &nbsp;*</span><br></li><li class="L3"><span class="com">&nbsp; &nbsp; &nbsp;* @param bis &nbsp; &nbsp;the stream to read from.</span><br></li><li class="L4"><span class="com">&nbsp; &nbsp; &nbsp;* @param result the samples array to populate, must be the same length as bitsPerSample.length.</span><br></li><li class="L5"><span class="com">&nbsp; &nbsp; &nbsp;* @throws IOException</span><br></li><li class="L6"><span class="com">&nbsp; &nbsp; &nbsp;*/</span><span class="pln"></span><br></li><li class="L7"><span class="pln">&nbsp; &nbsp; </span><span class="kwd">void</span><span class="pln"> getSamplesAsBytes</span><span class="pun">(</span><span class="kwd">final</span><span class="pln"> </span><span class="typ">BitInputStream</span><span class="pln"> bis</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">[]</span><span class="pln"> result</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">throws</span><span class="pln"> </span><span class="typ">IOException</span><span class="pln"> </span><span class="pun">{</span><span class="pln"></span><br></li><li class="L8"><span class="pln"></span><span class="fc bfc" id="L329" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> bitsPerSample</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L9"><span class="pln"></span><span class="fc" id="L330"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> bits </span><span class="pun">=</span><span class="pln"> bitsPerSample</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span></span><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="fc" id="L331"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">int</span><span class="pln"> sample </span><span class="pun">=</span><span class="pln"> bis</span><span class="pun">.</span><span class="pln">readBits</span><span class="pun">(</span><span class="pln">bits</span><span class="pun">);</span></span><span class="pln"></span><br></li><li class="L1"><span class="pln"></span><span class="fc bfc" id="L332" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">bits </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">8</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><span class="fc" id="L333"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> sign </span><span class="pun">=</span><span class="pln"> sample </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><span class="fc" id="L334"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sample </span><span class="pun">=</span><span class="pln"> sample </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">8</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> bits</span><span class="pun">;</span><span class="pln"> </span><span class="com">// scale to byte.</span></span><span class="pln"></span><br></li><li class="L4"><span class="pln"></span><span class="fc bfc" id="L335" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">sign </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L5"><span class="pln"></span><span class="fc" id="L336"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sample </span><span class="pun">=</span><span class="pln"> sample </span><span class="pun">|</span><span class="pln"> </span><span class="pun">(</span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">8</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> bits</span><span class="pun">)</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> </span><span class="com">// extend to byte</span></span><span class="pln"></span><br></li><li class="L6"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L7"><span class="pln"></span><span class="pc bpc" id="L338" title="1 of 2 branches missed."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">bits </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">8</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L8"><span class="pln"></span><span class="nc" id="L339"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sample </span><span class="pun">=</span><span class="pln"> sample </span><span class="pun">&gt;&gt;</span><span class="pln"> bits </span><span class="pun">-</span><span class="pln"> </span><span class="lit">8</span><span class="pun">;</span><span class="pln"> </span><span class="com">// extend to byte.</span></span><span class="pln"></span><br></li><li class="L9"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="fc" id="L341"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> sample</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L1"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><span class="fc" id="L343"><span class="pln">&nbsp; &nbsp; </span><span class="pun">}</span></span><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><br></li><li class="L4"><span class="pln">&nbsp; &nbsp; </span><span class="com">/**</span><br></li><li class="L5"><span class="com">&nbsp; &nbsp; &nbsp;* Checks if all the bits per sample entries are the same size.</span><br></li><li class="L6"><span class="com">&nbsp; &nbsp; &nbsp;*</span><br></li><li class="L7"><span class="com">&nbsp; &nbsp; &nbsp;* @param size the size to check.</span><br></li><li class="L8"><span class="com">&nbsp; &nbsp; &nbsp;* @return true if all the bits per sample entries are the same.</span><br></li><li class="L9"><span class="com">&nbsp; &nbsp; &nbsp;*/</span><span class="pln"></span><br></li><li class="L0"><span class="pln">&nbsp; &nbsp; </span><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> isHomogenous</span><span class="pun">(</span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> size</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"></span><br></li><li class="L1"><span class="pln"></span><span class="fc bfc" id="L352" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> element </span><span class="pun">:</span><span class="pln"> bitsPerSample</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><span class="fc bfc" id="L353" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">element </span><span class="pun">!=</span><span class="pln"> size</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><span class="fc" id="L354"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L4"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L5"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><span class="fc" id="L357"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L7"><span class="pln">&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L8"><span class="pln"></span><br></li><li class="L9"><span class="pln">&nbsp; &nbsp; </span><span class="com">/**</span><br></li><li class="L0"><span class="com">&nbsp; &nbsp; &nbsp;* Reads the image data from the IFD associated with this instance of ImageDataReader using the optional sub-image specification if desired.</span><br></li><li class="L1"><span class="com">&nbsp; &nbsp; &nbsp;*</span><br></li><li class="L2"><span class="com">&nbsp; &nbsp; &nbsp;* @param subImageSpecification a rectangle describing a sub-region of the image for reading, or a null if the whole image is to be read.</span><br></li><li class="L3"><span class="com">&nbsp; &nbsp; &nbsp;* @param hasAlpha &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;indicates that the image has an alpha (transparency) channel (RGB color model only).</span><br></li><li class="L4"><span class="com">&nbsp; &nbsp; &nbsp;* @param isAlphaPremultiplied &nbsp;indicates that the image uses the associated alpha channel format (pre-multiplied alpha).</span><br></li><li class="L5"><span class="com">&nbsp; &nbsp; &nbsp;* @return a valid instance containing the pixel data from the image.</span><br></li><li class="L6"><span class="com">&nbsp; &nbsp; &nbsp;* @throws IOException &nbsp; &nbsp; &nbsp;in the event of an unrecoverable I/O error.</span><br></li><li class="L7"><span class="com">&nbsp; &nbsp; &nbsp;* @throws ImagingException TODO</span><br></li><li class="L8"><span class="com">&nbsp; &nbsp; &nbsp;*/</span><span class="pln"></span><br></li><li class="L9"><span class="pln">&nbsp; &nbsp; </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">abstract</span><span class="pln"> </span><span class="typ">ImageBuilder</span><span class="pln"> readImageData</span><span class="pun">(</span><span class="typ">Rectangle</span><span class="pln"> subImageSpecification</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> hasAlpha</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> isAlphaPremultiplied</span><span class="pun">)</span><span class="pln"></span><br></li><li class="L0"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">throws</span><span class="pln"> </span><span class="typ">IOException</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ImagingException</span><span class="pun">;</span><span class="pln"></span><br></li><li class="L1"><span class="pln"></span><br></li><li class="L2"><span class="pln">&nbsp; &nbsp; </span><span class="com">/**</span><br></li><li class="L3"><span class="com">&nbsp; &nbsp; &nbsp;* Defines a method for accessing the floating-point raster data in a TIFF image. These implementations of this method in DataReaderStrips and</span><br></li><li class="L4"><span class="com">&nbsp; &nbsp; &nbsp;* DataReaderTiled assume that this instance is of a compatible data type (floating-point) and that all access checks have already been performed.</span><br></li><li class="L5"><span class="com">&nbsp; &nbsp; &nbsp;*</span><br></li><li class="L6"><span class="com">&nbsp; &nbsp; &nbsp;* @param subImage if non-null, instructs the access method to retrieve only a sub-section of the image data.</span><br></li><li class="L7"><span class="com">&nbsp; &nbsp; &nbsp;* @return a valid instance</span><br></li><li class="L8"><span class="com">&nbsp; &nbsp; &nbsp;* @throws ImagingException in the event of an incompatible data form.</span><br></li><li class="L9"><span class="com">&nbsp; &nbsp; &nbsp;* @throws IOException &nbsp; &nbsp; &nbsp;in the event of I/O error.</span><br></li><li class="L0"><span class="com">&nbsp; &nbsp; &nbsp;*/</span><span class="pln"></span><br></li><li class="L1"><span class="pln">&nbsp; &nbsp; </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">abstract</span><span class="pln"> </span><span class="typ">AbstractTiffRasterData</span><span class="pln"> readRasterData</span><span class="pun">(</span><span class="typ">Rectangle</span><span class="pln"> subImage</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">throws</span><span class="pln"> </span><span class="typ">ImagingException</span><span class="pun">,</span><span class="pln"> </span><span class="typ">IOException</span><span class="pun">;</span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><br></li><li class="L3"><span class="pln">&nbsp; &nbsp; </span><span class="com">/**</span><br></li><li class="L4"><span class="com">&nbsp; &nbsp; &nbsp;* Resets the predictor state.</span><br></li><li class="L5"><span class="com">&nbsp; &nbsp; &nbsp;*/</span><span class="pln"></span><br></li><li class="L6"><span class="pln">&nbsp; &nbsp; </span><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> resetPredictor</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"></span><br></li><li class="L7"><span class="pln"></span><span class="fc" id="L388"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ">Arrays</span><span class="pun">.</span><span class="pln">fill</span><span class="pun">(</span><span class="pln">last</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span></span><span class="pln"></span><br></li><li class="L8"><span class="pln"></span><span class="fc" id="L389"><span class="pln">&nbsp; &nbsp; </span><span class="pun">}</span></span><span class="pln"></span><br></li><li class="L9"><span class="pln"></span><br></li><li class="L0"><span class="pln">&nbsp; &nbsp; </span><span class="com">/**</span><br></li><li class="L1"><span class="com">&nbsp; &nbsp; &nbsp;* Transfer samples obtained from the TIFF file to a floating-point raster.</span><br></li><li class="L2"><span class="com">&nbsp; &nbsp; &nbsp;*</span><br></li><li class="L3"><span class="com">&nbsp; &nbsp; &nbsp;* @param xBlock &nbsp; &nbsp; &nbsp; coordinate of block relative to source data</span><br></li><li class="L4"><span class="com">&nbsp; &nbsp; &nbsp;* @param yBlock &nbsp; &nbsp; &nbsp; coordinate of block relative to source data</span><br></li><li class="L5"><span class="com">&nbsp; &nbsp; &nbsp;* @param blockWidth &nbsp; width of block, in pixels</span><br></li><li class="L6"><span class="com">&nbsp; &nbsp; &nbsp;* @param blockHeight &nbsp;height of block in pixels</span><br></li><li class="L7"><span class="com">&nbsp; &nbsp; &nbsp;* @param blockData &nbsp; &nbsp;the data for the block</span><br></li><li class="L8"><span class="com">&nbsp; &nbsp; &nbsp;* @param xRaster &nbsp; &nbsp; &nbsp;coordinate of raster relative to source data</span><br></li><li class="L9"><span class="com">&nbsp; &nbsp; &nbsp;* @param yRaster &nbsp; &nbsp; &nbsp;coordinate of raster relative to source data</span><br></li><li class="L0"><span class="com">&nbsp; &nbsp; &nbsp;* @param rasterWidth &nbsp;width of the raster (always smaller than source data)</span><br></li><li class="L1"><span class="com">&nbsp; &nbsp; &nbsp;* @param rasterHeight height of the raster (always smaller than source data)</span><br></li><li class="L2"><span class="com">&nbsp; &nbsp; &nbsp;* @param rasterData &nbsp; the raster data.</span><br></li><li class="L3"><span class="com">&nbsp; &nbsp; &nbsp;*</span><br></li><li class="L4"><span class="com">&nbsp; &nbsp; &nbsp;* Requirements:</span><br></li><li class="L5"><span class="com">&nbsp; &nbsp; &nbsp;* R1: The method transfers pixel sample data from a TIFF block (blockData)</span><br></li><li class="L6"><span class="com">&nbsp; &nbsp; &nbsp;* to a floating point raster buffer (rasterData).</span><br></li><li class="L7"><span class="com">&nbsp; &nbsp; &nbsp;*</span><br></li><li class="L8"><span class="com">&nbsp; &nbsp; &nbsp;* R2: Only the overlapping region between the src block and target raster</span><br></li><li class="L9"><span class="com">&nbsp; &nbsp; &nbsp;* shall be copied. Areas outside must be ignored.</span><br></li><li class="L0"><span class="com">&nbsp; &nbsp; &nbsp;*</span><br></li><li class="L1"><span class="com">&nbsp; &nbsp; &nbsp;* R3: Coordinates are translated from source-space to raster-space.</span><br></li><li class="L2"><span class="com">&nbsp; &nbsp; &nbsp;* - xBlock, yBlock define block origin in source coordinates</span><br></li><li class="L3"><span class="com">&nbsp; &nbsp; &nbsp;* - xRaster, yRaster define raster origin in source coordinates</span><br></li><li class="L4"><span class="com">&nbsp; &nbsp; &nbsp;* - Internal offsets (xR0, yR0, xB0, yB0) must ensure valid indexing.</span><br></li><li class="L5"><span class="com">&nbsp; &nbsp; &nbsp;*</span><br></li><li class="L6"><span class="com">&nbsp; &nbsp; &nbsp;* R4: No transfer shall occur if the computed overlap width or height</span><br></li><li class="L7"><span class="com">&nbsp; &nbsp; &nbsp;* is &lt;= 0.</span><br></li><li class="L8"><span class="com">&nbsp; &nbsp; &nbsp;*</span><br></li><li class="L9"><span class="com">&nbsp; &nbsp; &nbsp;* R5: Copied width and height are bounded by the block dimensions.</span><br></li><li class="L0"><span class="com">&nbsp; &nbsp; &nbsp;*</span><br></li><li class="L1"><span class="com">&nbsp; &nbsp; &nbsp;* R6: Source data (blockData) contains float values encoded as int bits</span><br></li><li class="L2"><span class="com">&nbsp; &nbsp; &nbsp;* and must be converted.</span><br></li><li class="L3"><span class="com">&nbsp; &nbsp; &nbsp;*</span><br></li><li class="L4"><span class="com">&nbsp; &nbsp; &nbsp;* R7: If samplesPerPixel == 1, data is copied directly.</span><br></li><li class="L5"><span class="com">&nbsp; &nbsp; &nbsp;*</span><br></li><li class="L6"><span class="com">&nbsp; &nbsp; &nbsp;* R8: If samplesPerPixel &gt; 1 and planarConfiguration is CHUNKY</span><br></li><li class="L7"><span class="com">&nbsp; &nbsp; &nbsp;* - Source data is chunky</span><br></li><li class="L8"><span class="com">&nbsp; &nbsp; &nbsp;* - Target raster is planar</span><br></li><li class="L9"><span class="com">&nbsp; &nbsp; &nbsp;* - Data must be converted from chunky to planar</span><br></li><li class="L0"><span class="com">&nbsp; &nbsp; &nbsp;*</span><br></li><li class="L1"><span class="com">&nbsp; &nbsp; &nbsp;* R9: If samplesPerPixel &gt; 1 and planarConfiguration is not CHUNKY</span><br></li><li class="L2"><span class="com">&nbsp; &nbsp; &nbsp;* - Source data is planar</span><br></li><li class="L3"><span class="com">&nbsp; &nbsp; &nbsp;* - Copy is done plane-by-plane</span><br></li><li class="L4"><span class="com">&nbsp; &nbsp; &nbsp;*</span><br></li><li class="L5"><span class="com">&nbsp; &nbsp; &nbsp;* R10: All indicies must be within bounds of blockData and rasterData.</span><br></li><li class="L6"><span class="com">&nbsp; &nbsp; &nbsp;*/</span><span class="pln"></span><br></li><li class="L7"><span class="pln">&nbsp; &nbsp; </span><span class="kwd">void</span><span class="pln"> transferBlockToRaster</span><span class="pun">(</span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> xBlock</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> yBlock</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> blockWidth</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> blockHeight</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">[]</span><span class="pln"> blockData</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> xRaster</span><span class="pun">,</span><span class="pln"></span><br></li><li class="L8"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> yRaster</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> rasterWidth</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> rasterHeight</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> samplesPerPixel</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">float</span><span class="pun">[]</span><span class="pln"> rasterData</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"></span><br></li><li class="L9"><span class="pln"></span><br></li><li class="L0"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// xR0, yR0 are the coordinates within the raster (upper-left corner)</span><span class="pln"></span><br></li><li class="L1"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// xR1, yR1 are ONE PAST the coordinates of the lower-right corner</span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><span class="fc" id="L443"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">int</span><span class="pln"> xR0 </span><span class="pun">=</span><span class="pln"> xBlock </span><span class="pun">-</span><span class="pln"> xRaster</span><span class="pun">;</span><span class="pln"> </span><span class="com">// xR0, yR0 coordinates relative to</span></span><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><span class="fc" id="L444"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">int</span><span class="pln"> yR0 </span><span class="pun">=</span><span class="pln"> yBlock </span><span class="pun">-</span><span class="pln"> yRaster</span><span class="pun">;</span><span class="pln"> </span><span class="com">// the raster</span></span><span class="pln"></span><br></li><li class="L4"><span class="pln"></span><span class="fc" id="L445"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">int</span><span class="pln"> xR1 </span><span class="pun">=</span><span class="pln"> xR0 </span><span class="pun">+</span><span class="pln"> blockWidth</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L5"><span class="pln"></span><span class="fc" id="L446"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">int</span><span class="pln"> yR1 </span><span class="pun">=</span><span class="pln"> yR0 </span><span class="pun">+</span><span class="pln"> blockHeight</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><span class="fc bfc" id="L447" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">xR0 </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L7"><span class="pln"></span><span class="fc" id="L448"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; xR0 </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L8"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L9"><span class="pln"></span><span class="fc bfc" id="L450" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">yR0 </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="fc" id="L451"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; yR0 </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L1"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><span class="fc bfc" id="L453" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">xR1 </span><span class="pun">&gt;</span><span class="pln"> rasterWidth</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><span class="fc" id="L454"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; xR1 </span><span class="pun">=</span><span class="pln"> rasterWidth</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L4"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L5"><span class="pln"></span><span class="fc bfc" id="L456" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">yR1 </span><span class="pun">&gt;</span><span class="pln"> rasterHeight</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><span class="fc" id="L457"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; yR1 </span><span class="pun">=</span><span class="pln"> rasterHeight</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L7"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L8"><span class="pln"></span><br></li><li class="L9"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// Recall that the above logic may have adjusted xR0, xY0 so that</span><span class="pln"></span><br></li><li class="L0"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// they are not necessarily point to the source pixel at xRaster, yRaster</span><span class="pln"></span><br></li><li class="L1"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// we compute xSource = xR0+xRaster.</span><span class="pln"></span><br></li><li class="L2"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// xOffset = xSource-xBlock</span><span class="pln"></span><br></li><li class="L3"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// since the block cannot be accessed with a negative offset,</span><span class="pln"></span><br></li><li class="L4"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// we check for negatives and adjust xR0, yR0 upward as necessary</span><span class="pln"></span><br></li><li class="L5"><span class="pln"></span><span class="fc" id="L466"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">int</span><span class="pln"> xB0 </span><span class="pun">=</span><span class="pln"> xR0 </span><span class="pun">+</span><span class="pln"> xRaster </span><span class="pun">-</span><span class="pln"> xBlock</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><span class="fc" id="L467"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">int</span><span class="pln"> yB0 </span><span class="pun">=</span><span class="pln"> yR0 </span><span class="pun">+</span><span class="pln"> yRaster </span><span class="pun">-</span><span class="pln"> yBlock</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L7"><span class="pln"></span><span class="pc bpc" id="L468" title="1 of 2 branches missed."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">xB0 </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L8"><span class="pln"></span><span class="nc" id="L469"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; xR0 </span><span class="pun">-=</span><span class="pln"> xB0</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L9"><span class="pln"></span><span class="nc" id="L470"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; xB0 </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L0"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L1"><span class="pln"></span><span class="pc bpc" id="L472" title="1 of 2 branches missed."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">yB0 </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><span class="nc" id="L473"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; yR0 </span><span class="pun">-=</span><span class="pln"> yB0</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><span class="nc" id="L474"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; yB0 </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L4"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L5"><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><span class="fc" id="L477"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">int</span><span class="pln"> w </span><span class="pun">=</span><span class="pln"> xR1 </span><span class="pun">-</span><span class="pln"> xR0</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L7"><span class="pln"></span><span class="fc" id="L478"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">int</span><span class="pln"> h </span><span class="pun">=</span><span class="pln"> yR1 </span><span class="pun">-</span><span class="pln"> yR0</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L8"><span class="pln"></span><span class="pc bpc" id="L479" title="2 of 4 branches missed."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">w </span><span class="pun">&lt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> h </span><span class="pun">&lt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L9"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// The call to this method put the block outside the</span><span class="pln"></span><br></li><li class="L0"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// bounds of the raster. There is nothing to do. Ideally,</span><span class="pln"></span><br></li><li class="L1"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// this situation never arises, because it would mean that</span><span class="pln"></span><br></li><li class="L2"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// the data was read from the file unnecessarily.</span><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><span class="nc" id="L484"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L4"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L5"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// see if the xR1, yR1 would extend past the limits of the block</span><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><span class="pc bpc" id="L487" title="1 of 2 branches missed."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">w </span><span class="pun">&gt;</span><span class="pln"> blockWidth</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L7"><span class="pln"></span><span class="nc" id="L488"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; w </span><span class="pun">=</span><span class="pln"> blockWidth</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L8"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L9"><span class="pln"></span><span class="pc bpc" id="L490" title="1 of 2 branches missed."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">h </span><span class="pun">&gt;</span><span class="pln"> blockHeight</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="nc" id="L491"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; h </span><span class="pun">=</span><span class="pln"> blockHeight</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L1"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><br></li><li class="L3"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// The TiffRasterData class expects data to be in the order</span><span class="pln"></span><br></li><li class="L4"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// corresponding to TiffPlanarConfiguration.PLANAR. So for the</span><span class="pln"></span><br></li><li class="L5"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// multivariable case, we must convert CHUNKY data to PLANAR.</span><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><span class="fc bfc" id="L497" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">samplesPerPixel </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L7"><span class="pln"></span><span class="fc bfc" id="L498" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> h</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L8"><span class="pln"></span><span class="fc" id="L499"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> yR </span><span class="pun">=</span><span class="pln"> yR0 </span><span class="pun">+</span><span class="pln"> i</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L9"><span class="pln"></span><span class="fc" id="L500"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> yB </span><span class="pun">=</span><span class="pln"> yB0 </span><span class="pun">+</span><span class="pln"> i</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="fc" id="L501"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> rOffset </span><span class="pun">=</span><span class="pln"> yR </span><span class="pun">*</span><span class="pln"> rasterWidth </span><span class="pun">+</span><span class="pln"> xR0</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L1"><span class="pln"></span><span class="fc" id="L502"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> bOffset </span><span class="pun">=</span><span class="pln"> yB </span><span class="pun">*</span><span class="pln"> blockWidth </span><span class="pun">+</span><span class="pln"> xB0</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><span class="fc bfc" id="L503" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;</span><span class="pln"> w</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><span class="fc" id="L504"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rasterData</span><span class="pun">[</span><span class="pln">rOffset </span><span class="pun">+</span><span class="pln"> j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Float</span><span class="pun">.</span><span class="pln">intBitsToFloat</span><span class="pun">(</span><span class="pln">blockData</span><span class="pun">[</span><span class="pln">bOffset </span><span class="pun">+</span><span class="pln"> j</span><span class="pun">]);</span></span><span class="pln"></span><br></li><li class="L4"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L5"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><span class="fc bfc" id="L507" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">planarConfiguration </span><span class="pun">==</span><span class="pln"> </span><span class="typ">TiffPlanarConfiguration</span><span class="pun">.</span><span class="pln">CHUNKY</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L7"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// The source data is in the interleaved (Chunky) order,</span><span class="pln"></span><br></li><li class="L8"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// but the TiffRasterData class expects non-interleaved order.</span><span class="pln"></span><br></li><li class="L9"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// So we transcribe the elements as appropriate.</span><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="fc" id="L511"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> pixelsPerPlane </span><span class="pun">=</span><span class="pln"> rasterWidth </span><span class="pun">*</span><span class="pln"> rasterHeight</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L1"><span class="pln"></span><span class="fc bfc" id="L512" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> h</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><span class="fc" id="L513"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> yR </span><span class="pun">=</span><span class="pln"> yR0 </span><span class="pun">+</span><span class="pln"> i</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><span class="fc" id="L514"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> yB </span><span class="pun">=</span><span class="pln"> yB0 </span><span class="pun">+</span><span class="pln"> i</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L4"><span class="pln"></span><span class="fc" id="L515"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> rOffset </span><span class="pun">=</span><span class="pln"> yR </span><span class="pun">*</span><span class="pln"> rasterWidth </span><span class="pun">+</span><span class="pln"> xR0</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L5"><span class="pln"></span><span class="fc" id="L516"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> bOffset </span><span class="pun">=</span><span class="pln"> yB </span><span class="pun">*</span><span class="pln"> blockWidth </span><span class="pun">+</span><span class="pln"> xB0</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><span class="fc bfc" id="L517" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;</span><span class="pln"> w</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L7"><span class="pln"></span><span class="fc bfc" id="L518" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> k </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> k </span><span class="pun">&lt;</span><span class="pln"> samplesPerPixel</span><span class="pun">;</span><span class="pln"> k</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L8"><span class="pln"></span><span class="fc" id="L519"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rasterData</span><span class="pun">[</span><span class="pln">k </span><span class="pun">*</span><span class="pln"> pixelsPerPlane </span><span class="pun">+</span><span class="pln"> rOffset </span><span class="pun">+</span><span class="pln"> j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Float</span><span class="pun">.</span><span class="pln">intBitsToFloat</span><span class="pun">(</span><span class="pln">blockData</span><span class="pun">[(</span><span class="pln">bOffset </span><span class="pun">+</span><span class="pln"> j</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> samplesPerPixel </span><span class="pun">+</span><span class="pln"> k</span><span class="pun">]);</span></span><span class="pln"></span><br></li><li class="L9"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L0"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L1"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><span class="fc" id="L523"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><span class="fc bfc" id="L524" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> iPlane </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> iPlane </span><span class="pun">&lt;</span><span class="pln"> samplesPerPixel</span><span class="pun">;</span><span class="pln"> iPlane</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L4"><span class="pln"></span><span class="fc" id="L525"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> rPlanarOffset </span><span class="pun">=</span><span class="pln"> iPlane </span><span class="pun">*</span><span class="pln"> rasterWidth </span><span class="pun">*</span><span class="pln"> rasterHeight</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L5"><span class="pln"></span><span class="fc" id="L526"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> bPlanarOffset </span><span class="pun">=</span><span class="pln"> iPlane </span><span class="pun">*</span><span class="pln"> blockWidth </span><span class="pun">*</span><span class="pln"> blockHeight</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><span class="fc bfc" id="L527" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> h</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L7"><span class="pln"></span><span class="fc" id="L528"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> yR </span><span class="pun">=</span><span class="pln"> yR0 </span><span class="pun">+</span><span class="pln"> i</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L8"><span class="pln"></span><span class="fc" id="L529"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> yB </span><span class="pun">=</span><span class="pln"> yB0 </span><span class="pun">+</span><span class="pln"> i</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L9"><span class="pln"></span><span class="fc" id="L530"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> rOffset </span><span class="pun">=</span><span class="pln"> rPlanarOffset </span><span class="pun">+</span><span class="pln"> yR </span><span class="pun">*</span><span class="pln"> rasterWidth </span><span class="pun">+</span><span class="pln"> xR0</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="fc" id="L531"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> bOffset </span><span class="pun">=</span><span class="pln"> bPlanarOffset </span><span class="pun">+</span><span class="pln"> yB </span><span class="pun">*</span><span class="pln"> blockWidth </span><span class="pun">+</span><span class="pln"> xB0</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L1"><span class="pln"></span><span class="fc bfc" id="L532" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;</span><span class="pln"> w</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><span class="fc" id="L533"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rasterData</span><span class="pun">[</span><span class="pln">rOffset </span><span class="pun">+</span><span class="pln"> j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Float</span><span class="pun">.</span><span class="pln">intBitsToFloat</span><span class="pun">(</span><span class="pln">blockData</span><span class="pun">[</span><span class="pln">bOffset </span><span class="pun">+</span><span class="pln"> j</span><span class="pun">]);</span></span><span class="pln"></span><br></li><li class="L3"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L4"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L5"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L6"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L7"><span class="pln"></span><br></li><li class="L8"><span class="pln"></span><span class="fc" id="L539"><span class="pln">&nbsp; &nbsp; </span><span class="pun">}</span></span><span class="pln"></span><br></li><li class="L9"><span class="pln"></span><br></li><li class="L0"><span class="pln">&nbsp; &nbsp; </span><span class="com">/**</span><br></li><li class="L1"><span class="com">&nbsp; &nbsp; &nbsp;* Transfer samples obtained from the TIFF file to an integer raster.</span><br></li><li class="L2"><span class="com">&nbsp; &nbsp; &nbsp;*</span><br></li><li class="L3"><span class="com">&nbsp; &nbsp; &nbsp;* @param xBlock &nbsp; &nbsp; &nbsp; coordinate of block relative to source data.</span><br></li><li class="L4"><span class="com">&nbsp; &nbsp; &nbsp;* @param yBlock &nbsp; &nbsp; &nbsp; coordinate of block relative to source data.</span><br></li><li class="L5"><span class="com">&nbsp; &nbsp; &nbsp;* @param blockWidth &nbsp; width of block, in pixels.</span><br></li><li class="L6"><span class="com">&nbsp; &nbsp; &nbsp;* @param blockHeight &nbsp;height of block in pixels.</span><br></li><li class="L7"><span class="com">&nbsp; &nbsp; &nbsp;* @param blockData &nbsp; &nbsp;the data for the block.</span><br></li><li class="L8"><span class="com">&nbsp; &nbsp; &nbsp;* @param xRaster &nbsp; &nbsp; &nbsp;coordinate of raster relative to source data.</span><br></li><li class="L9"><span class="com">&nbsp; &nbsp; &nbsp;* @param yRaster &nbsp; &nbsp; &nbsp;coordinate of raster relative to source data.</span><br></li><li class="L0"><span class="com">&nbsp; &nbsp; &nbsp;* @param rasterWidth &nbsp;width of the raster (always smaller than source data).</span><br></li><li class="L1"><span class="com">&nbsp; &nbsp; &nbsp;* @param rasterHeight height of the raster (always smaller than source data).</span><br></li><li class="L2"><span class="com">&nbsp; &nbsp; &nbsp;* @param rasterData &nbsp; the raster data.</span><br></li><li class="L3"><span class="com">&nbsp; &nbsp; &nbsp;*/</span><span class="pln"></span><br></li><li class="L4"><span class="pln">&nbsp; &nbsp; </span><span class="kwd">void</span><span class="pln"> transferBlockToRaster</span><span class="pun">(</span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> xBlock</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> yBlock</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> blockWidth</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> blockHeight</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">[]</span><span class="pln"> blockData</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> xRaster</span><span class="pun">,</span><span class="pln"></span><br></li><li class="L5"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> yRaster</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> rasterWidth</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> rasterHeight</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">[]</span><span class="pln"> rasterData</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><br></li><li class="L7"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// xR0, yR0 are the coordinates within the raster (upper-left corner)</span><span class="pln"></span><br></li><li class="L8"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// xR1, yR1 are ONE PAST the coordinates of the lower-right corner</span><span class="pln"></span><br></li><li class="L9"><span class="pln"></span><span class="fc" id="L560"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">int</span><span class="pln"> xR0 </span><span class="pun">=</span><span class="pln"> xBlock </span><span class="pun">-</span><span class="pln"> xRaster</span><span class="pun">;</span><span class="pln"> </span><span class="com">// xR0, yR0 coordinates relative to</span></span><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="fc" id="L561"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">int</span><span class="pln"> yR0 </span><span class="pun">=</span><span class="pln"> yBlock </span><span class="pun">-</span><span class="pln"> yRaster</span><span class="pun">;</span><span class="pln"> </span><span class="com">// the raster</span></span><span class="pln"></span><br></li><li class="L1"><span class="pln"></span><span class="fc" id="L562"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">int</span><span class="pln"> xR1 </span><span class="pun">=</span><span class="pln"> xR0 </span><span class="pun">+</span><span class="pln"> blockWidth</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><span class="fc" id="L563"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">int</span><span class="pln"> yR1 </span><span class="pun">=</span><span class="pln"> yR0 </span><span class="pun">+</span><span class="pln"> blockHeight</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><span class="fc bfc" id="L564" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">xR0 </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L4"><span class="pln"></span><span class="fc" id="L565"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; xR0 </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L5"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><span class="fc bfc" id="L567" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">yR0 </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L7"><span class="pln"></span><span class="fc" id="L568"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; yR0 </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L8"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L9"><span class="pln"></span><span class="fc bfc" id="L570" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">xR1 </span><span class="pun">&gt;</span><span class="pln"> rasterWidth</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="fc" id="L571"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; xR1 </span><span class="pun">=</span><span class="pln"> rasterWidth</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L1"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><span class="fc bfc" id="L573" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">yR1 </span><span class="pun">&gt;</span><span class="pln"> rasterHeight</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><span class="fc" id="L574"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; yR1 </span><span class="pun">=</span><span class="pln"> rasterHeight</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L4"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L5"><span class="pln"></span><br></li><li class="L6"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// Recall that the above logic may have adjusted xR0, xY0 so that</span><span class="pln"></span><br></li><li class="L7"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// they are not necessarily point to the source pixel at xRaster, yRaster</span><span class="pln"></span><br></li><li class="L8"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// we compute xSource = xR0+xRaster.</span><span class="pln"></span><br></li><li class="L9"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// xOffset = xSource-xBlock</span><span class="pln"></span><br></li><li class="L0"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// since the block cannot be accessed with a negative offset,</span><span class="pln"></span><br></li><li class="L1"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// we check for negatives and adjust xR0, yR0 upward as necessary</span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><span class="fc" id="L583"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">int</span><span class="pln"> xB0 </span><span class="pun">=</span><span class="pln"> xR0 </span><span class="pun">+</span><span class="pln"> xRaster </span><span class="pun">-</span><span class="pln"> xBlock</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><span class="fc" id="L584"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">int</span><span class="pln"> yB0 </span><span class="pun">=</span><span class="pln"> yR0 </span><span class="pun">+</span><span class="pln"> yRaster </span><span class="pun">-</span><span class="pln"> yBlock</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L4"><span class="pln"></span><span class="pc bpc" id="L585" title="1 of 2 branches missed."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">xB0 </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L5"><span class="pln"></span><span class="nc" id="L586"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; xR0 </span><span class="pun">-=</span><span class="pln"> xB0</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><span class="nc" id="L587"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; xB0 </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L7"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L8"><span class="pln"></span><span class="pc bpc" id="L589" title="1 of 2 branches missed."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">yB0 </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L9"><span class="pln"></span><span class="nc" id="L590"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; yR0 </span><span class="pun">-=</span><span class="pln"> yB0</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="nc" id="L591"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; yB0 </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L1"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><span class="fc" id="L594"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">int</span><span class="pln"> w </span><span class="pun">=</span><span class="pln"> xR1 </span><span class="pun">-</span><span class="pln"> xR0</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L4"><span class="pln"></span><span class="fc" id="L595"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">int</span><span class="pln"> h </span><span class="pun">=</span><span class="pln"> yR1 </span><span class="pun">-</span><span class="pln"> yR0</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L5"><span class="pln"></span><span class="pc bpc" id="L596" title="2 of 4 branches missed."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">w </span><span class="pun">&lt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> h </span><span class="pun">&lt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L6"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// The call to this method puts the block outside the</span><span class="pln"></span><br></li><li class="L7"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// bounds of the raster. There is nothing to do. Ideally,</span><span class="pln"></span><br></li><li class="L8"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// this situation never arises, because it would mean that</span><span class="pln"></span><br></li><li class="L9"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// the data was read from the file unnecessarily.</span><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="nc" id="L601"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L1"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L2"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// see if the xR1, yR1 would extend past the limits of the block</span><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><span class="pc bpc" id="L604" title="1 of 2 branches missed."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">w </span><span class="pun">&gt;</span><span class="pln"> blockWidth</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L4"><span class="pln"></span><span class="nc" id="L605"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; w </span><span class="pun">=</span><span class="pln"> blockWidth</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L5"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><span class="pc bpc" id="L607" title="1 of 2 branches missed."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">h </span><span class="pun">&gt;</span><span class="pln"> blockHeight</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L7"><span class="pln"></span><span class="nc" id="L608"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; h </span><span class="pun">=</span><span class="pln"> blockHeight</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L8"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L9"><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="fc bfc" id="L611" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> h</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L1"><span class="pln"></span><span class="fc" id="L612"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> yR </span><span class="pun">=</span><span class="pln"> yR0 </span><span class="pun">+</span><span class="pln"> i</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><span class="fc" id="L613"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> yB </span><span class="pun">=</span><span class="pln"> yB0 </span><span class="pun">+</span><span class="pln"> i</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><span class="fc" id="L614"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> rOffset </span><span class="pun">=</span><span class="pln"> yR </span><span class="pun">*</span><span class="pln"> rasterWidth </span><span class="pun">+</span><span class="pln"> xR0</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L4"><span class="pln"></span><span class="fc" id="L615"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> bOffset </span><span class="pun">=</span><span class="pln"> yB </span><span class="pun">*</span><span class="pln"> blockWidth </span><span class="pun">+</span><span class="pln"> xB0</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L5"><span class="pln"></span><span class="fc" id="L616"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ">System</span><span class="pun">.</span><span class="pln">arraycopy</span><span class="pun">(</span><span class="pln">blockData</span><span class="pun">,</span><span class="pln"> bOffset</span><span class="pun">,</span><span class="pln"> rasterData</span><span class="pun">,</span><span class="pln"> rOffset</span><span class="pun">,</span><span class="pln"> w</span><span class="pun">);</span></span><span class="pln"></span><br></li><li class="L6"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L7"><span class="pln"></span><span class="fc" id="L618"><span class="pln">&nbsp; &nbsp; </span><span class="pun">}</span></span><span class="pln"></span><br></li><li class="L8"><span class="pln"></span><br></li><li class="L9"><span class="pln">&nbsp; &nbsp; </span><span class="com">/**</span><br></li><li class="L0"><span class="com">&nbsp; &nbsp; &nbsp;* Given a source file that specifies the floating-point data format, unpack the raw bytes obtained from the source file and organize them into an array of</span><br></li><li class="L1"><span class="com">&nbsp; &nbsp; &nbsp;* integers containing the bit-equivalent of IEEE-754 32-bit floats. Source files containing 64 bit doubles are downcast to floats.</span><br></li><li class="L2"><span class="com">&nbsp; &nbsp; &nbsp;* &lt;p&gt;</span><br></li><li class="L3"><span class="com">&nbsp; &nbsp; &nbsp;* This method supports either the tile format or the strip format of TIFF source files. The scan size indicates the number of columns to be extracted. For</span><br></li><li class="L4"><span class="com">&nbsp; &nbsp; &nbsp;* strips, the width and the scan size are always the full width of the image. For tiles, the scan size is the full width of the tile, but the width may be</span><br></li><li class="L5"><span class="com">&nbsp; &nbsp; &nbsp;* smaller in the cases where the tiles do not evenly divide the width (for example, a 256 pixel wide tile in a 257 pixel wide image would result in two</span><br></li><li class="L6"><span class="com">&nbsp; &nbsp; &nbsp;* columns of tiles, the second column having only one column of pixels that were worth extracting.</span><br></li><li class="L7"><span class="com">&nbsp; &nbsp; &nbsp;*</span><br></li><li class="L8"><span class="com">&nbsp; &nbsp; &nbsp;* @param width &nbsp; &nbsp; &nbsp; &nbsp;the width of the data block to be extracted.</span><br></li><li class="L9"><span class="com">&nbsp; &nbsp; &nbsp;* @param height &nbsp; &nbsp; &nbsp; the height of the data block to be extracted.</span><br></li><li class="L0"><span class="com">&nbsp; &nbsp; &nbsp;* @param scanSize &nbsp; &nbsp; the number of pixels in a single row of the block.</span><br></li><li class="L1"><span class="com">&nbsp; &nbsp; &nbsp;* @param bytes &nbsp; &nbsp; &nbsp; &nbsp;the raw bytes.</span><br></li><li class="L2"><span class="com">&nbsp; &nbsp; &nbsp;* @param bitsPerPixel the number of bits per sample, 32 or 64.</span><br></li><li class="L3"><span class="com">&nbsp; &nbsp; &nbsp;* @param byteOrder &nbsp; &nbsp;the byte order for the source data.</span><br></li><li class="L4"><span class="com">&nbsp; &nbsp; &nbsp;* @return a valid array of integers in row major order, dimensions scan-size wide and height.</span><br></li><li class="L5"><span class="com">&nbsp; &nbsp; &nbsp;* @throws ImagingException in the event of an invalid format.</span><br></li><li class="L6"><span class="com">&nbsp; &nbsp; &nbsp;*/</span><span class="pln"></span><br></li><li class="L7"><span class="pln">&nbsp; &nbsp; </span><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">[]</span><span class="pln"> unpackFloatingPointSamples</span><span class="pun">(</span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> width</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> height</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> scanSize</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">byte</span><span class="pun">[]</span><span class="pln"> bytes</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> bitsPerPixel</span><span class="pun">,</span><span class="pln"></span><br></li><li class="L8"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">ByteOrder</span><span class="pln"> byteOrder</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">throws</span><span class="pln"> </span><span class="typ">ImagingException</span><span class="pln"> </span><span class="pun">{</span><span class="pln"></span><br></li><li class="L9"><span class="pln"></span><span class="fc" id="L640"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> bitsPerSample </span><span class="pun">=</span><span class="pln"> bitsPerPixel </span><span class="pun">/</span><span class="pln"> samplesPerPixel</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="fc" id="L641"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> bytesPerSample </span><span class="pun">=</span><span class="pln"> bitsPerSample </span><span class="pun">/</span><span class="pln"> </span><span class="lit">8</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L1"><span class="pln"></span><span class="fc" id="L642"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> bytesPerScan </span><span class="pun">=</span><span class="pln"> scanSize </span><span class="pun">*</span><span class="pln"> samplesPerPixel </span><span class="pun">*</span><span class="pln"> bytesPerSample</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><span class="fc" id="L643"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> nBytes </span><span class="pun">=</span><span class="pln"> bytesPerScan </span><span class="pun">*</span><span class="pln"> height</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><span class="pc bpc" id="L644" title="1 of 2 branches missed."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> length </span><span class="pun">=</span><span class="pln"> bytes</span><span class="pun">.</span><span class="pln">length </span><span class="pun">&lt;</span><span class="pln"> nBytes </span><span class="pun">?</span><span class="pln"> nBytes </span><span class="pun">/</span><span class="pln"> bytesPerScan </span><span class="pun">:</span><span class="pln"> height</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L4"><span class="pln"></span><span class="fc" id="L645"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">[]</span><span class="pln"> samples </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Allocator</span><span class="pun">.</span><span class="pln">intArray</span><span class="pun">(</span><span class="pln">scanSize </span><span class="pun">*</span><span class="pln"> samplesPerPixel </span><span class="pun">*</span><span class="pln"> height</span><span class="pun">);</span></span><span class="pln"></span><br></li><li class="L5"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// floating-point differencing is indicated by a predictor value of 3.</span><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><span class="fc bfc" id="L647" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">predictor </span><span class="pun">==</span><span class="pln"> </span><span class="typ">TiffTagConstants</span><span class="pun">.</span><span class="pln">PREDICTOR_VALUE_FLOATING_POINT_DIFFERENCING</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L7"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// at this time, this class supports the 32-bit format. The</span><span class="pln"></span><br></li><li class="L8"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// main reason for this is that we have not located sample data</span><span class="pln"></span><br></li><li class="L9"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// that can be used for testing and analysis.</span><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="pc bpc" id="L651" title="1 of 2 branches missed."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">bitsPerPixel </span><span class="pun">/</span><span class="pln"> samplesPerPixel </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">32</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L1"><span class="pln"></span><span class="nc" id="L652"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ImagingException</span><span class="pun">(</span></span><span class="pln"></span><br></li><li class="L2"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="str">"Imaging does not yet support floating-point data with predictor type 3 for "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> bitsPerPixel </span><span class="pun">+</span><span class="pln"> </span><span class="str">" bits per sample"</span><span class="pun">);</span><span class="pln"></span><br></li><li class="L3"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L4"><span class="pln"></span><br></li><li class="L5"><span class="pln"></span><span class="fc bfc" id="L656" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">planarConfiguration </span><span class="pun">==</span><span class="pln"> </span><span class="typ">TiffPlanarConfiguration</span><span class="pun">.</span><span class="pln">CHUNKY</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><span class="fc" id="L657"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> bytesInRow </span><span class="pun">=</span><span class="pln"> scanSize </span><span class="pun">*</span><span class="pln"> </span><span class="lit">4</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> samplesPerPixel</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L7"><span class="pln"></span><span class="fc bfc" id="L658" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> length</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L8"><span class="pln"></span><span class="fc" id="L659"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> aOffset </span><span class="pun">=</span><span class="pln"> i </span><span class="pun">*</span><span class="pln"> bytesInRow</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L9"><span class="pln"></span><span class="fc" id="L660"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> bOffset </span><span class="pun">=</span><span class="pln"> aOffset </span><span class="pun">+</span><span class="pln"> scanSize </span><span class="pun">*</span><span class="pln"> samplesPerPixel</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="fc" id="L661"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> cOffset </span><span class="pun">=</span><span class="pln"> bOffset </span><span class="pun">+</span><span class="pln"> scanSize </span><span class="pun">*</span><span class="pln"> samplesPerPixel</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L1"><span class="pln"></span><span class="fc" id="L662"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> dOffset </span><span class="pun">=</span><span class="pln"> cOffset </span><span class="pun">+</span><span class="pln"> scanSize </span><span class="pun">*</span><span class="pln"> samplesPerPixel</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L2"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// in this loop, the source bytes give delta values.</span><span class="pln"></span><br></li><li class="L3"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// we adjust them to give true values. This operation is</span><span class="pln"></span><br></li><li class="L4"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// done on a row-by-row basis.</span><span class="pln"></span><br></li><li class="L5"><span class="pln"></span><span class="fc bfc" id="L666" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;</span><span class="pln"> bytesInRow</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><span class="fc" id="L667"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bytes</span><span class="pun">[</span><span class="pln">aOffset </span><span class="pun">+</span><span class="pln"> j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> bytes</span><span class="pun">[</span><span class="pln">aOffset </span><span class="pun">+</span><span class="pln"> j </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">];</span></span><span class="pln"></span><br></li><li class="L7"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L8"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// pack the bytes into the integer bit-equivalent of</span><span class="pln"></span><br></li><li class="L9"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// floating point values</span><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="fc" id="L671"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">int</span><span class="pln"> index </span><span class="pun">=</span><span class="pln"> i </span><span class="pun">*</span><span class="pln"> scanSize</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L1"><span class="pln"></span><span class="fc bfc" id="L672" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;</span><span class="pln"> width </span><span class="pun">*</span><span class="pln"> samplesPerPixel</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><span class="fc" id="L673"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> a </span><span class="pun">=</span><span class="pln"> bytes</span><span class="pun">[</span><span class="pln">aOffset </span><span class="pun">+</span><span class="pln"> j</span><span class="pun">];</span></span><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><span class="fc" id="L674"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> b </span><span class="pun">=</span><span class="pln"> bytes</span><span class="pun">[</span><span class="pln">bOffset </span><span class="pun">+</span><span class="pln"> j</span><span class="pun">];</span></span><span class="pln"></span><br></li><li class="L4"><span class="pln"></span><span class="fc" id="L675"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> c </span><span class="pun">=</span><span class="pln"> bytes</span><span class="pun">[</span><span class="pln">cOffset </span><span class="pun">+</span><span class="pln"> j</span><span class="pun">];</span></span><span class="pln"></span><br></li><li class="L5"><span class="pln"></span><span class="fc" id="L676"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> d </span><span class="pun">=</span><span class="pln"> bytes</span><span class="pun">[</span><span class="pln">dOffset </span><span class="pun">+</span><span class="pln"> j</span><span class="pun">];</span></span><span class="pln"></span><br></li><li class="L6"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// Pack the 4 byte components into a single integer</span><span class="pln"></span><br></li><li class="L7"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// in the byte order used by the TIFF standard</span><span class="pln"></span><br></li><li class="L8"><span class="pln"></span><span class="fc" id="L679"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; samples</span><span class="pun">[</span><span class="pln">index</span><span class="pun">++]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0xff</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">24</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="pun">(</span><span class="pln">b </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0xff</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">16</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="pun">(</span><span class="pln">c </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0xff</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">8</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> d </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0xff</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L9"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L0"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L1"><span class="pln"></span><span class="fc" id="L682"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><span class="fc" id="L683"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> bytesInRow </span><span class="pun">=</span><span class="pln"> scanSize </span><span class="pun">*</span><span class="pln"> </span><span class="lit">4</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><span class="fc bfc" id="L684" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> iPlane </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> iPlane </span><span class="pun">&lt;</span><span class="pln"> samplesPerPixel</span><span class="pun">;</span><span class="pln"> iPlane</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L4"><span class="pln"></span><span class="fc" id="L685"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> planarIntOffset </span><span class="pun">=</span><span class="pln"> iPlane </span><span class="pun">*</span><span class="pln"> length </span><span class="pun">*</span><span class="pln"> scanSize</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L5"><span class="pln"></span><span class="fc" id="L686"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> planarByteOffset </span><span class="pun">=</span><span class="pln"> planarIntOffset </span><span class="pun">*</span><span class="pln"> </span><span class="lit">4</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><br></li><li class="L7"><span class="pln"></span><span class="fc bfc" id="L688" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> length</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L8"><span class="pln"></span><span class="fc" id="L689"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> aOffset </span><span class="pun">=</span><span class="pln"> i </span><span class="pun">*</span><span class="pln"> bytesInRow </span><span class="pun">+</span><span class="pln"> planarByteOffset</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L9"><span class="pln"></span><span class="fc" id="L690"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> bOffset </span><span class="pun">=</span><span class="pln"> aOffset </span><span class="pun">+</span><span class="pln"> scanSize</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="fc" id="L691"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> cOffset </span><span class="pun">=</span><span class="pln"> bOffset </span><span class="pun">+</span><span class="pln"> scanSize</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L1"><span class="pln"></span><span class="fc" id="L692"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> dOffset </span><span class="pun">=</span><span class="pln"> cOffset </span><span class="pun">+</span><span class="pln"> scanSize</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L2"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// in this loop, the source bytes give delta values.</span><span class="pln"></span><br></li><li class="L3"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// we adjust them to give true values. This operation is</span><span class="pln"></span><br></li><li class="L4"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// done on a row-by-row basis.</span><span class="pln"></span><br></li><li class="L5"><span class="pln"></span><span class="fc bfc" id="L696" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;</span><span class="pln"> bytesInRow</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><span class="fc" id="L697"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bytes</span><span class="pun">[</span><span class="pln">aOffset </span><span class="pun">+</span><span class="pln"> j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> bytes</span><span class="pun">[</span><span class="pln">aOffset </span><span class="pun">+</span><span class="pln"> j </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">];</span></span><span class="pln"></span><br></li><li class="L7"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L8"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// pack the bytes into the integer bit-equivalent of</span><span class="pln"></span><br></li><li class="L9"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// floating point values</span><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="fc" id="L701"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">int</span><span class="pln"> index </span><span class="pun">=</span><span class="pln"> planarIntOffset </span><span class="pun">+</span><span class="pln"> i </span><span class="pun">*</span><span class="pln"> scanSize</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L1"><span class="pln"></span><span class="fc bfc" id="L702" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;</span><span class="pln"> width</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><span class="fc" id="L703"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> a </span><span class="pun">=</span><span class="pln"> bytes</span><span class="pun">[</span><span class="pln">aOffset </span><span class="pun">+</span><span class="pln"> j</span><span class="pun">];</span></span><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><span class="fc" id="L704"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> b </span><span class="pun">=</span><span class="pln"> bytes</span><span class="pun">[</span><span class="pln">bOffset </span><span class="pun">+</span><span class="pln"> j</span><span class="pun">];</span></span><span class="pln"></span><br></li><li class="L4"><span class="pln"></span><span class="fc" id="L705"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> c </span><span class="pun">=</span><span class="pln"> bytes</span><span class="pun">[</span><span class="pln">cOffset </span><span class="pun">+</span><span class="pln"> j</span><span class="pun">];</span></span><span class="pln"></span><br></li><li class="L5"><span class="pln"></span><span class="fc" id="L706"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> d </span><span class="pun">=</span><span class="pln"> bytes</span><span class="pun">[</span><span class="pln">dOffset </span><span class="pun">+</span><span class="pln"> j</span><span class="pun">];</span></span><span class="pln"></span><br></li><li class="L6"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// Pack the 4 byte components into a single integer</span><span class="pln"></span><br></li><li class="L7"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// in the byte order used by the TIFF standard</span><span class="pln"></span><br></li><li class="L8"><span class="pln"></span><span class="fc" id="L709"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; samples</span><span class="pun">[</span><span class="pln">index</span><span class="pun">++]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0xff</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">24</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="pun">(</span><span class="pln">b </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0xff</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">16</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="pun">(</span><span class="pln">c </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0xff</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">8</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> d </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0xff</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L9"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L0"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L1"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><br></li><li class="L3"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L4"><span class="pln"></span><span class="fc" id="L715"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> samples</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L5"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"> </span><span class="com">// end of predictor==3 case.</span><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><br></li><li class="L7"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// simple packing case, 64 or 32 bits --------------------------</span><span class="pln"></span><br></li><li class="L8"><span class="pln"></span><span class="fc bfc" id="L719" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">bitsPerSample </span><span class="pun">==</span><span class="pln"> </span><span class="lit">64</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L9"><span class="pln"></span><span class="fc" id="L720"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">int</span><span class="pln"> k </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="fc" id="L721"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">int</span><span class="pln"> index </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L1"><span class="pln"></span><span class="fc bfc" id="L722" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> length</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><span class="fc bfc" id="L723" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;</span><span class="pln"> scanSize</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><span class="fc" id="L724"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> b0 </span><span class="pun">=</span><span class="pln"> bytes</span><span class="pun">[</span><span class="pln">k</span><span class="pun">++]</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0xffL</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L4"><span class="pln"></span><span class="fc" id="L725"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> b1 </span><span class="pun">=</span><span class="pln"> bytes</span><span class="pun">[</span><span class="pln">k</span><span class="pun">++]</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0xffL</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L5"><span class="pln"></span><span class="fc" id="L726"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> b2 </span><span class="pun">=</span><span class="pln"> bytes</span><span class="pun">[</span><span class="pln">k</span><span class="pun">++]</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0xffL</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><span class="fc" id="L727"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> b3 </span><span class="pun">=</span><span class="pln"> bytes</span><span class="pun">[</span><span class="pln">k</span><span class="pun">++]</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0xffL</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L7"><span class="pln"></span><span class="fc" id="L728"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> b4 </span><span class="pun">=</span><span class="pln"> bytes</span><span class="pun">[</span><span class="pln">k</span><span class="pun">++]</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0xffL</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L8"><span class="pln"></span><span class="fc" id="L729"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> b5 </span><span class="pun">=</span><span class="pln"> bytes</span><span class="pun">[</span><span class="pln">k</span><span class="pun">++]</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0xffL</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L9"><span class="pln"></span><span class="fc" id="L730"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> b6 </span><span class="pun">=</span><span class="pln"> bytes</span><span class="pun">[</span><span class="pln">k</span><span class="pun">++]</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0xffL</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="fc" id="L731"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> b7 </span><span class="pun">=</span><span class="pln"> bytes</span><span class="pun">[</span><span class="pln">k</span><span class="pun">++]</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0xffL</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L1"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> sbits</span><span class="pun">;</span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><span class="fc bfc" id="L733" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">byteOrder </span><span class="pun">==</span><span class="pln"> </span><span class="typ">ByteOrder</span><span class="pun">.</span><span class="pln">LITTLE_ENDIAN</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><span class="fc" id="L734"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sbits </span><span class="pun">=</span><span class="pln"> b7 </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">56</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> b6 </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">48</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> b5 </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">40</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> b4 </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">32</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> b3 </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">24</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> b2 </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">16</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> b1 </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">8</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> b0</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L4"><span class="pln"></span><br></li><li class="L5"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><span class="fc" id="L737"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sbits </span><span class="pun">=</span><span class="pln"> b0 </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">56</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> b1 </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">48</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> b2 </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">40</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> b3 </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">32</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> b4 </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">24</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> b5 </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">16</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> b6 </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">8</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> b7</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L7"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L8"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// since the photometric interpreter does not</span><span class="pln"></span><br></li><li class="L9"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// currently support doubles, we need to replace this</span><span class="pln"></span><br></li><li class="L0"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// element with a float. This action is inefficient and</span><span class="pln"></span><br></li><li class="L1"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// should be improved.</span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><span class="fc" id="L743"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">float</span><span class="pln"> f </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">float</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Double</span><span class="pun">.</span><span class="pln">longBitsToDouble</span><span class="pun">(</span><span class="pln">sbits</span><span class="pun">);</span></span><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><span class="fc" id="L744"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; samples</span><span class="pun">[</span><span class="pln">index</span><span class="pun">++]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Float</span><span class="pun">.</span><span class="pln">floatToRawIntBits</span><span class="pun">(</span><span class="pln">f</span><span class="pun">);</span></span><span class="pln"></span><br></li><li class="L4"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L5"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><span class="pc bpc" id="L747" title="1 of 2 branches missed."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">bitsPerSample </span><span class="pun">==</span><span class="pln"> </span><span class="lit">32</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L7"><span class="pln"></span><span class="fc" id="L748"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">int</span><span class="pln"> k </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L8"><span class="pln"></span><span class="fc" id="L749"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">int</span><span class="pln"> index </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L9"><span class="pln"></span><span class="fc bfc" id="L750" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> length</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="fc bfc" id="L751" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;</span><span class="pln"> scanSize </span><span class="pun">*</span><span class="pln"> samplesPerPixel</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L1"><span class="pln"></span><span class="fc" id="L752"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> b0 </span><span class="pun">=</span><span class="pln"> bytes</span><span class="pun">[</span><span class="pln">k</span><span class="pun">++]</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0xff</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><span class="fc" id="L753"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> b1 </span><span class="pun">=</span><span class="pln"> bytes</span><span class="pun">[</span><span class="pln">k</span><span class="pun">++]</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0xff</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><span class="fc" id="L754"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> b2 </span><span class="pun">=</span><span class="pln"> bytes</span><span class="pun">[</span><span class="pln">k</span><span class="pun">++]</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0xff</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L4"><span class="pln"></span><span class="fc" id="L755"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> b3 </span><span class="pun">=</span><span class="pln"> bytes</span><span class="pun">[</span><span class="pln">k</span><span class="pun">++]</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0xff</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L5"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> sbits</span><span class="pun">;</span><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><span class="fc bfc" id="L757" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">byteOrder </span><span class="pun">==</span><span class="pln"> </span><span class="typ">ByteOrder</span><span class="pun">.</span><span class="pln">LITTLE_ENDIAN</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L7"><span class="pln"></span><span class="fc" id="L758"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sbits </span><span class="pun">=</span><span class="pln"> b3 </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">24</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> b2 </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">16</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> b1 </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">8</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> b0</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L8"><span class="pln"></span><br></li><li class="L9"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="fc" id="L761"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sbits </span><span class="pun">=</span><span class="pln"> b0 </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">24</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> b1 </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">16</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> b2 </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">8</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> b3</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L1"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L2"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// since the photometric interpreter does not</span><span class="pln"></span><br></li><li class="L3"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// currently support doubles, we need to replace this</span><span class="pln"></span><br></li><li class="L4"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// element with a float. This action is inefficient and</span><span class="pln"></span><br></li><li class="L5"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// should be improved.</span><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><span class="fc" id="L767"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; samples</span><span class="pun">[</span><span class="pln">index</span><span class="pun">++]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> sbits</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L7"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L8"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L9"><span class="pln"></span><span class="fc" id="L770"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="nc" id="L771"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ImagingException</span><span class="pun">(</span><span class="str">"Imaging does not support floating-point samples with "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> bitsPerPixel </span><span class="pun">+</span><span class="pln"> </span><span class="str">" bits per sample"</span><span class="pun">);</span></span><span class="pln"></span><br></li><li class="L1"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><span class="fc" id="L774"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> samples</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L4"><span class="pln">&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L5"><span class="pln"></span><br></li><li class="L6"><span class="pln">&nbsp; &nbsp; </span><span class="com">/**</span><br></li><li class="L7"><span class="com">&nbsp; &nbsp; &nbsp;* Given a source file that specifies numerical data as short integers, unpack the raw bytes obtained from the source file and organize them into an array</span><br></li><li class="L8"><span class="com">&nbsp; &nbsp; &nbsp;* of integers.</span><br></li><li class="L9"><span class="com">&nbsp; &nbsp; &nbsp;* &lt;p&gt;</span><br></li><li class="L0"><span class="com">&nbsp; &nbsp; &nbsp;* This method supports either the tile format or the strip format of TIFF source files. The scan size indicates the number of columns to be extracted. For</span><br></li><li class="L1"><span class="com">&nbsp; &nbsp; &nbsp;* strips, the width and the scan size are always the full width of the image. For tiles, the scan size is the full width of the tile, but the "width"</span><br></li><li class="L2"><span class="com">&nbsp; &nbsp; &nbsp;* parameter may be smaller in the cases where the tiles do not evenly divide the width (for example, a 256 pixel wide tile in a 257 pixel wide image would</span><br></li><li class="L3"><span class="com">&nbsp; &nbsp; &nbsp;* result in two columns of tiles, the second column having only one column of pixels that were worth extracting.</span><br></li><li class="L4"><span class="com">&nbsp; &nbsp; &nbsp;*</span><br></li><li class="L5"><span class="com">&nbsp; &nbsp; &nbsp;* @param width &nbsp; &nbsp; &nbsp; &nbsp; the width of the data block to be extracted.</span><br></li><li class="L6"><span class="com">&nbsp; &nbsp; &nbsp;* @param height &nbsp; &nbsp; &nbsp; &nbsp;the height of the data block to be extracted.</span><br></li><li class="L7"><span class="com">&nbsp; &nbsp; &nbsp;* @param scanSize &nbsp; &nbsp; &nbsp;the number of pixels in a single row of the block.</span><br></li><li class="L8"><span class="com">&nbsp; &nbsp; &nbsp;* @param bytes &nbsp; &nbsp; &nbsp; &nbsp; the raw bytes.</span><br></li><li class="L9"><span class="com">&nbsp; &nbsp; &nbsp;* @param predictor &nbsp; &nbsp; the predictor specified by the source, only predictor 3 is supported.</span><br></li><li class="L0"><span class="com">&nbsp; &nbsp; &nbsp;* @param bitsPerSample the number of bits per sample, 32 or 64.</span><br></li><li class="L1"><span class="com">&nbsp; &nbsp; &nbsp;* @param byteOrder &nbsp; &nbsp; the byte order for the source data</span><br></li><li class="L2"><span class="com">&nbsp; &nbsp; &nbsp;* @return a valid array of integers in row major order, dimensions scan-size wide and height.</span><br></li><li class="L3"><span class="com">&nbsp; &nbsp; &nbsp;*/</span><span class="pln"></span><br></li><li class="L4"><span class="pln">&nbsp; &nbsp; </span><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">[]</span><span class="pln"> unpackIntSamples</span><span class="pun">(</span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> width</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> height</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> scanSize</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">byte</span><span class="pun">[]</span><span class="pln"> bytes</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> predictor</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> bitsPerSample</span><span class="pun">,</span><span class="pln"></span><br></li><li class="L5"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">ByteOrder</span><span class="pln"> byteOrder</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><span class="fc" id="L797"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> bytesPerSample </span><span class="pun">=</span><span class="pln"> bitsPerSample </span><span class="pun">/</span><span class="pln"> </span><span class="lit">8</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L7"><span class="pln"></span><span class="fc" id="L798"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> nBytes </span><span class="pun">=</span><span class="pln"> bytesPerSample </span><span class="pun">*</span><span class="pln"> scanSize </span><span class="pun">*</span><span class="pln"> height</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L8"><span class="pln"></span><span class="fc bfc" id="L799" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> length </span><span class="pun">=</span><span class="pln"> bytes</span><span class="pun">.</span><span class="pln">length </span><span class="pun">&lt;</span><span class="pln"> nBytes </span><span class="pun">?</span><span class="pln"> nBytes </span><span class="pun">/</span><span class="pln"> scanSize </span><span class="pun">:</span><span class="pln"> height</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L9"><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="fc" id="L801"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">[]</span><span class="pln"> samples </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Allocator</span><span class="pun">.</span><span class="pln">intArray</span><span class="pun">(</span><span class="pln">scanSize </span><span class="pun">*</span><span class="pln"> height</span><span class="pun">);</span></span><span class="pln"></span><br></li><li class="L1"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// At this time, Commons Imaging only supports two-byte</span><span class="pln"></span><br></li><li class="L2"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// two's complement short integers. It is assumed that</span><span class="pln"></span><br></li><li class="L3"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// the calling module already checked the arguments for</span><span class="pln"></span><br></li><li class="L4"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// compliance, so this method simply assumes that they are correct.</span><span class="pln"></span><br></li><li class="L5"><span class="pln"></span><br></li><li class="L6"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// The logic that follows is simplified by the fact that</span><span class="pln"></span><br></li><li class="L7"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// the existing API only supports two-byte signed integers.</span><span class="pln"></span><br></li><li class="L8"><span class="pln"></span><span class="fc bfc" id="L809" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> useDifferencing </span><span class="pun">=</span><span class="pln"> predictor </span><span class="pun">==</span><span class="pln"> </span><span class="typ">TiffTagConstants</span><span class="pun">.</span><span class="pln">PREDICTOR_VALUE_HORIZONTAL_DIFFERENCING</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L9"><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="fc bfc" id="L811" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> length</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L1"><span class="pln"></span><span class="fc" id="L812"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> index </span><span class="pun">=</span><span class="pln"> i </span><span class="pun">*</span><span class="pln"> scanSize</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><span class="fc" id="L813"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">int</span><span class="pln"> offset </span><span class="pun">=</span><span class="pln"> index </span><span class="pun">*</span><span class="pln"> bytesPerSample</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><span class="fc bfc" id="L814" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">bitsPerSample </span><span class="pun">==</span><span class="pln"> </span><span class="lit">16</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L4"><span class="pln"></span><span class="fc bfc" id="L815" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">byteOrder </span><span class="pun">==</span><span class="pln"> </span><span class="typ">ByteOrder</span><span class="pun">.</span><span class="pln">LITTLE_ENDIAN</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L5"><span class="pln"></span><span class="fc bfc" id="L816" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;</span><span class="pln"> width</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++,</span><span class="pln"> offset </span><span class="pun">+=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><span class="fc" id="L817"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; samples</span><span class="pun">[</span><span class="pln">index </span><span class="pun">+</span><span class="pln"> j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> bytes</span><span class="pun">[</span><span class="pln">offset </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">8</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> bytes</span><span class="pun">[</span><span class="pln">offset</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0xff</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L7"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L8"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln"></span><br></li><li class="L9"><span class="pln"></span><span class="fc bfc" id="L820" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;</span><span class="pln"> width</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++,</span><span class="pln"> offset </span><span class="pun">+=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="fc" id="L821"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; samples</span><span class="pun">[</span><span class="pln">index </span><span class="pun">+</span><span class="pln"> j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> bytes</span><span class="pun">[</span><span class="pln">offset</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">8</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> bytes</span><span class="pun">[</span><span class="pln">offset </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0xff</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L1"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L2"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><span class="fc bfc" id="L824" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">bitsPerSample </span><span class="pun">==</span><span class="pln"> </span><span class="lit">32</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L4"><span class="pln"></span><span class="fc bfc" id="L825" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">byteOrder </span><span class="pun">==</span><span class="pln"> </span><span class="typ">ByteOrder</span><span class="pun">.</span><span class="pln">LITTLE_ENDIAN</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L5"><span class="pln"></span><span class="fc bfc" id="L826" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;</span><span class="pln"> width</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++,</span><span class="pln"> offset </span><span class="pun">+=</span><span class="pln"> </span><span class="lit">4</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><span class="fc" id="L827"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; samples</span><span class="pun">[</span><span class="pln">index </span><span class="pun">+</span><span class="pln"> j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> bytes</span><span class="pun">[</span><span class="pln">offset </span><span class="pun">+</span><span class="pln"> </span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">24</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="pun">(</span><span class="pln">bytes</span><span class="pun">[</span><span class="pln">offset </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0xff</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">16</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="pun">(</span><span class="pln">bytes</span><span class="pun">[</span><span class="pln">offset </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0xff</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">8</span></span><span class="pln"></span><br></li><li class="L7"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">|</span><span class="pln"> bytes</span><span class="pun">[</span><span class="pln">offset</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0xff</span><span class="pun">;</span><span class="pln"></span><br></li><li class="L8"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L9"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln"></span><br></li><li class="L0"><span class="pln"></span><span class="fc bfc" id="L831" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;</span><span class="pln"> width</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++,</span><span class="pln"> offset </span><span class="pun">+=</span><span class="pln"> </span><span class="lit">4</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L1"><span class="pln"></span><span class="fc" id="L832"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; samples</span><span class="pun">[</span><span class="pln">index </span><span class="pun">+</span><span class="pln"> j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> bytes</span><span class="pun">[</span><span class="pln">offset</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">24</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="pun">(</span><span class="pln">bytes</span><span class="pun">[</span><span class="pln">offset </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0xff</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">16</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="pun">(</span><span class="pln">bytes</span><span class="pun">[</span><span class="pln">offset </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0xff</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">8</span></span><span class="pln"></span><br></li><li class="L2"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">|</span><span class="pln"> bytes</span><span class="pun">[</span><span class="pln">offset </span><span class="pun">+</span><span class="pln"> </span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0xff</span><span class="pun">;</span><span class="pln"></span><br></li><li class="L3"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L4"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L5"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L6"><span class="pln"></span><span class="fc bfc" id="L837" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">useDifferencing</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L7"><span class="pln"></span><span class="fc bfc" id="L838" title="All 2 branches covered."><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;</span><span class="pln"> width</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span></span><span class="pln"></span><br></li><li class="L8"><span class="pln"></span><span class="fc" id="L839"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; samples</span><span class="pun">[</span><span class="pln">index </span><span class="pun">+</span><span class="pln"> j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> samples</span><span class="pun">[</span><span class="pln">index </span><span class="pun">+</span><span class="pln"> j </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">];</span></span><span class="pln"></span><br></li><li class="L9"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L0"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L1"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L2"><span class="pln"></span><br></li><li class="L3"><span class="pln"></span><span class="fc" id="L844"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> samples</span><span class="pun">;</span></span><span class="pln"></span><br></li><li class="L4"><span class="pln">&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"></span><br></li><li class="L5"><span class="pln"></span><span class="pun">}</span></li></ol></pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>